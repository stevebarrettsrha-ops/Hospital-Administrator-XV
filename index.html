<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hospital Administrator Dashboard â€” Standalone</title>

  <!-- Tailwind (Play CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React + ReactDOM (UMD) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel for in-browser JSX transpile -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- SheetJS for Excel export -->
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>

  <style>
    /* Chief Orderly Dashboard Inspired Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #6ee7b7 0%, #7dd3fc 100%);
      min-height: 100vh;
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-fadeIn { animation: fadeIn 0.4s ease; }
    .animate-slideUp { animation: slideUp 0.5s ease; }
    .animate-slideDown { animation: slideDown 0.3s ease; }

    /* Navigation Header */
    .nav-header {
      background: white;
      border-radius: 12px;
      padding: 20px 30px;
      margin-bottom: 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .nav-tabs {
      display: flex;
      gap: 10px;
      background: #f7fafc;
      padding: 6px;
      border-radius: 10px;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
      background: transparent;
      color: #718096;
    }

    .nav-tab:hover {
      color: #1a202c;
      background: #e2e8f0;
    }

    .nav-tab.active {
      background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    /* Main Icon */
    .main-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    /* Buttons */
    .btn-primary {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
    }

    /* Cards */
    .dashboard-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .dashboard-card:hover {
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      transform: translateY(-2px);
    }

    /* Stats */
    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
      border-left: 4px solid;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .stat-card.blue { border-left-color: #0ea5e9; }
    .stat-card.green { border-left-color: #10b981; }
    .stat-card.purple { border-left-color: #a855f7; }
    .stat-card.red { border-left-color: #ef4444; }

    /* Form Inputs */
    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 14px;
      transition: all 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #10b981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    }

    .form-input.error {
      border-color: #ef4444;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
    }

    /* User Info Badge */
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      background: rgba(16, 185, 129, 0.1);
      padding: 10px 20px;
      border-radius: 25px;
    }

    /* Table Styling */
    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      padding: 12px 16px;
      text-align: left;
      font-size: 13px;
      font-weight: 600;
      color: #4a5568;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .data-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
    }

    .data-table tr:hover {
      background: #f7fafc;
    }

    .data-table tr.total-row {
      background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
      font-weight: 600;
    }

    /* Priority Badges */
    .priority-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .priority-badge.high {
      background: #fee2e2;
      color: #ef4444;
    }

    .priority-badge.medium {
      background: #fef3c7;
      color: #f59e0b;
    }

    .priority-badge.low {
      background: #d1fae5;
      color: #10b981;
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 12px;
      animation: slideDown 0.3s ease;
    }

    .toast.success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
    .toast.error { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; }
    .toast.warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
    .toast.info { background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 24px;
      border-bottom: 2px solid #e2e8f0;
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 16px 24px;
      border-top: 2px solid #e2e8f0;
    }

    /* Chart container */
    .chart-container { width: 100%; height: 260px; }

    /* Icon buttons */
    .icon-btn {
      background: #f7fafc;
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 16px;
    }

    .icon-btn:hover {
      background: #e2e8f0;
      transform: scale(1.1);
    }

    .icon-btn.edit:hover { background: #dbeafe; color: #0ea5e9; }
    .icon-btn.delete:hover { background: #fee2e2; color: #ef4444; }

    /* Department Card */
    .dept-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
      border-left: 4px solid;
    }

    .dept-card:hover {
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      transform: translateX(5px);
    }

    .dept-card.high { border-left-color: #ef4444; }
    .dept-card.medium { border-left-color: #f59e0b; }
    .dept-card.low { border-left-color: #10b981; }

    /* Dark mode overrides */
    .dark .nav-header,
    .dark .dashboard-card,
    .dark .stat-card,
    .dark .dept-card,
    .dark .modal-content {
      background: #1f2937;
      color: #f3f4f6;
    }

    .dark .nav-tabs {
      background: #374151;
    }

    .dark .nav-tab {
      color: #9ca3af;
    }

    .dark .nav-tab:hover {
      background: #4b5563;
      color: #f3f4f6;
    }

    .dark .form-input {
      background: #374151;
      border-color: #4b5563;
      color: #f3f4f6;
    }

    .dark .data-table th {
      background: #374151;
      color: #d1d5db;
    }

    .dark .data-table td {
      border-bottom-color: #374151;
    }

    .dark .data-table tr:hover {
      background: #374151;
    }

    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #10b981, #0ea5e9);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #059669, #0284c7);
    }

    /* Login Page Styles */
    .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #6ee7b7 0%, #7dd3fc 100%);
      padding: 20px;
    }

    .login-box {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 420px;
      overflow: hidden;
      animation: slideUp 0.5s ease;
    }

    .login-header {
      background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
      padding: 40px 30px;
      text-align: center;
      color: white;
    }

    .login-icon {
      width: 80px;
      height: 80px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      font-size: 36px;
      backdrop-filter: blur(10px);
    }

    .login-header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .login-header p {
      font-size: 14px;
      opacity: 0.9;
    }

    .login-form {
      padding: 40px 30px;
    }

    .login-input-group {
      margin-bottom: 20px;
    }

    .login-input-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #374151;
      margin-bottom: 8px;
    }

    .login-input {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 15px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .login-input:focus {
      outline: none;
      border-color: #10b981;
      box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
    }

    .login-input.error {
      border-color: #ef4444;
      box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.1);
    }

    .login-btn {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .login-btn:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .login-error {
      background: #fef2f2;
      border: 1px solid #fecaca;
      color: #dc2626;
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
      animation: slideDown 0.3s ease;
    }

    .login-info {
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      color: #1d4ed8;
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .login-footer {
      text-align: center;
      padding: 20px 30px 30px;
      border-top: 1px solid #f3f4f6;
    }

    .login-footer p {
      font-size: 13px;
      color: #6b7280;
    }

    .remember-me {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #4b5563;
    }

    .remember-me input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #10b981;
    }

    /* Dark mode login styles */
    .dark .login-box {
      background: #1f2937;
    }

    .dark .login-input-group label {
      color: #d1d5db;
    }

    .dark .login-input {
      background: #374151;
      border-color: #4b5563;
      color: #f3f4f6;
    }

    .dark .login-footer {
      border-top-color: #374151;
    }

    .dark .login-footer p {
      color: #9ca3af;
    }

    .dark .remember-me {
      color: #d1d5db;
    }

    /* Calendar Styles */
    .calendar-container {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
      color: white;
    }

    .calendar-nav-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      width: 36px;
      height: 36px;
      border-radius: 8px;
      color: white;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .calendar-nav-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: #e2e8f0;
    }

    .calendar-day-header {
      background: #f7fafc;
      padding: 12px;
      text-align: center;
      font-weight: 600;
      font-size: 12px;
      color: #718096;
      text-transform: uppercase;
    }

    .calendar-day {
      background: white;
      min-height: 100px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .calendar-day:hover {
      background: #f7fafc;
    }

    .calendar-day.other-month {
      background: #f7fafc;
      color: #a0aec0;
    }

    .calendar-day.today {
      background: #ecfdf5;
    }

    .calendar-day.today::before {
      content: '';
      position: absolute;
      top: 4px;
      right: 4px;
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
    }

    .calendar-day-number {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .calendar-event {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 4px;
      margin-bottom: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .calendar-event.sick { background: #fee2e2; color: #dc2626; }
    .calendar-event.vacation { background: #f3e8ff; color: #9333ea; }
    .calendar-event.dayoff { background: #fef3c7; color: #d97706; }
    .calendar-event.departmental { background: #dbeafe; color: #2563eb; }

    /* Notification Dropdown */
    .notification-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      width: 360px;
      max-height: 400px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      overflow: hidden;
      animation: slideDown 0.3s ease;
    }

    .notification-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e2e8f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    }

    .notification-list {
      max-height: 300px;
      overflow-y: auto;
    }

    .notification-item {
      padding: 14px 20px;
      border-bottom: 1px solid #f7fafc;
      display: flex;
      gap: 12px;
      transition: background 0.2s;
      cursor: pointer;
    }

    .notification-item:hover {
      background: #f7fafc;
    }

    .notification-item.urgent {
      border-left: 3px solid #ef4444;
      background: #fef2f2;
    }

    .notification-item.warning {
      border-left: 3px solid #f59e0b;
      background: #fffbeb;
    }

    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }

    .notification-icon.urgent { background: #fee2e2; }
    .notification-icon.warning { background: #fef3c7; }
    .notification-icon.info { background: #dbeafe; }

    /* Leave Badge */
    .leave-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .leave-badge.sick { background: #fee2e2; color: #dc2626; }
    .leave-badge.vacation { background: #f3e8ff; color: #9333ea; }
    .leave-badge.dayoff { background: #fef3c7; color: #d97706; }
    .leave-badge.departmental { background: #dbeafe; color: #2563eb; }

    /* Time Tracking Card */
    .time-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      border-left: 4px solid;
    }

    .time-card.claims { border-left-color: #3b82f6; }
    .time-card.late { border-left-color: #ef4444; }
    .time-card.overtime { border-left-color: #10b981; }
    .time-card.dayoff { border-left-color: #f59e0b; }

    /* View Toggle Buttons */
    .view-toggle {
      display: inline-flex;
      background: #f7fafc;
      border-radius: 8px;
      padding: 4px;
    }

    .view-toggle button {
      padding: 8px 16px;
      border: none;
      background: transparent;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      color: #718096;
    }

    .view-toggle button.active {
      background: white;
      color: #1a202c;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* Staff Card */
    .staff-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s;
    }

    .staff-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
    }

    .staff-avatar {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: white;
      font-size: 18px;
    }

    /* Role Badge */
    .role-badge {
      display: inline-block;
      padding: 3px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .role-badge.staff { background: #dbeafe; color: #2563eb; }
    .role-badge.senior { background: #d1fae5; color: #059669; }
    .role-badge.supervisor { background: #fef3c7; color: #d97706; }
    .role-badge.lead { background: #f3e8ff; color: #9333ea; }

    /* Dark mode for new components */
    .dark .calendar-container,
    .dark .notification-dropdown,
    .dark .time-card,
    .dark .staff-card {
      background: #1f2937;
    }

    .dark .calendar-day {
      background: #1f2937;
    }

    .dark .calendar-day:hover {
      background: #374151;
    }

    .dark .calendar-day.other-month {
      background: #111827;
    }

    .dark .calendar-day.today {
      background: #064e3b;
    }

    .dark .calendar-day-header {
      background: #374151;
      color: #9ca3af;
    }

    .dark .notification-header {
      background: #374151;
      border-color: #4b5563;
    }

    .dark .notification-item {
      border-color: #374151;
    }

    .dark .notification-item:hover {
      background: #374151;
    }

    .dark .view-toggle {
      background: #374151;
    }

    .dark .view-toggle button {
      color: #9ca3af;
    }

    .dark .view-toggle button.active {
      background: #1f2937;
      color: #f3f4f6;
    }
  </style>
</head>
<body class="min-h-screen">

  <div id="root"></div>

  <script type="text/babel">
  const { useState, useEffect, useRef } = React;

  /***** Configuration *****/
  const SHEET_URL = 'https://docs.google.com/spreadsheets/d/1HTmxT2hM1XXChwPjIT2aGl93nnmcpvaMxLddzm4OouY/export?format=csv';
  const LS_KEY = 'hospital_dashboard_v1'; // localStorage key

  /***** Helper: CSV export *****/
  function downloadCSV(filename, content) {
    const blob = new Blob([content], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  /***** Default dataset (fallback if sheet fails) *****/
  const DEFAULT_DEPARTMENTS = [
    { name: "General Storage (Food/Sundries/Sanitation)", issues: "Decentralization of storage and limited storage space impacting efficiency. Breezeway leaks and floods storage area when it rains. Donation received from National Healthcare Enhancement Fund.", barriers: "Insufficient storage space, Chill Room Out of Commission", recommendations: "Overhead expansion. Repair or replace to maximize efficiency.", priority: "High" },
    { name: "Medical Sundries Storage", issues: "Medical Sundries room flooded each time tanks overflow or during heavy rain. Eyewash station needed for Chemical Room staff.", barriers: "Delay in paying suppliers", recommendations: "Relocate water tanks. Assess structure and correct defect to prevent flooding. Down payment made for eyewash station.", priority: "High" },
    { name: "Laundry Equipment/Seamstress", issues: "New Industrial Washer still out of commission. Heat nuisance in Folding Room due to malfunctioning AC.", barriers: "Delay in procuring part (circuit board) for AC Unit", recommendations: "Replace Unit or change out parts to maximize efficiency", priority: "Medium" },
    { name: "Target Pest Management", issues: "Contractor conducting pest treatment as scheduled. Final date in October 2025.", barriers: "None", recommendations: "Continue monitoring", priority: "Low" },
    { name: "Cleaning and Portering (MEL)", issues: "Deep cleaning not done as per schedule.", barriers: "Weakness in Supervision", recommendations: "Improve supervision protocols", priority: "Medium" },
    { name: "Security (Modern Investigations)", issues: "Inconsistency in supervision", barriers: "Communication", recommendations: "Improve service delivery through ongoing training and development of Security Officers", priority: "Medium" },
    { name: "Sanitation (Rentokil Limited)", issues: "Company is responsive and issues resolved in timely manner.", barriers: "None", recommendations: "Continue current service", priority: "Low" },
    { name: "Waste Disposal (SPM Waste Management)", issues: "Occasional delay in garbage pickup", barriers: "None", recommendations: "Contact SPM when there is a challenge", priority: "Low" }
  ];

  const DEFAULT_FLEET = [
    { ambulance: "304586", inter: 10, intra: 5, fuel: 96203.8, remarks: "" },
    { ambulance: "304992", inter: 19, intra: 16, fuel: 118114.59, remarks: "Awaiting new stretcher from Regional Fleet Manager" },
    { ambulance: "305126", inter: 8, intra: 8, fuel: 9720.5, remarks: "Loaned to Chapelton Hospital Sept 23-30, 2025" }
  ];

  const DEFAULT_PERSONNEL = [
    { title: "Driver Replacement", description: "Mr. Leaughn Williams joined the Transport Team on September 23, 2025 as ambulance driver. This was a well-needed replacement and drivers are now relieved." },
    { title: "Commendation", description: "Special commendation to the transport Team for their dedication and resilience throughout the challenging period." },
    { title: "Training - Mandatory Defensive Driving Workshop", description: "Mr. Griffiths, Mr. Williams and Mr. Douglas: October 1-2, 2025, 8:30am-5pm. Mr. Chambers, Mr. Lewis and Mr. Campbell: October 8-9, 2025." }
  ];

  /***** Default Staff Data *****/
  const DEFAULT_STAFF = [
    { id: 1, name: "James Williams", trn: "123-456-789", department: "Transport", role: "Staff", phone: "876-555-0101", email: "j.williams@hospital.gov.jm", status: "active" },
    { id: 2, name: "Sarah Brown", trn: "234-567-890", department: "Cleaning", role: "Supervisor", phone: "876-555-0102", email: "s.brown@hospital.gov.jm", status: "active" },
    { id: 3, name: "Michael Douglas", trn: "345-678-901", department: "Transport", role: "Senior Staff", phone: "876-555-0103", email: "m.douglas@hospital.gov.jm", status: "active" },
    { id: 4, name: "Patricia Campbell", trn: "456-789-012", department: "Security", role: "Team Lead", phone: "876-555-0104", email: "p.campbell@hospital.gov.jm", status: "active" },
    { id: 5, name: "Robert Lewis", trn: "567-890-123", department: "Laundry", role: "Staff", phone: "876-555-0105", email: "r.lewis@hospital.gov.jm", status: "active" }
  ];

  /***** Default Leave Records *****/
  const DEFAULT_LEAVE_RECORDS = [
    { id: 1, staffId: 1, staffName: "James Williams", type: "sick", startDate: "2025-12-20", endDate: "2025-12-22", reason: "Medical appointment and recovery", status: "approved", department: "Transport" },
    { id: 2, staffId: 2, staffName: "Sarah Brown", type: "vacation", startDate: "2025-12-24", endDate: "2025-12-31", reason: "Annual holiday leave", status: "approved", department: "Cleaning" },
    { id: 3, staffId: 3, staffName: "Michael Douglas", type: "departmental", startDate: "2025-12-19", endDate: "2025-12-19", reason: "Training workshop attendance", status: "approved", department: "Transport" },
    { id: 4, staffId: 4, staffName: "Patricia Campbell", type: "dayoff", startDate: "2025-12-21", endDate: "2025-12-21", reason: "Personal day", status: "pending", department: "Security" }
  ];

  /***** Default Time Tracking Records *****/
  const DEFAULT_TIME_RECORDS = [
    { id: 1, staffId: 1, staffName: "James Williams", type: "overtime", date: "2025-12-18", hours: 3, reason: "Extended ambulance coverage", department: "Transport" },
    { id: 2, staffId: 2, staffName: "Sarah Brown", type: "late", date: "2025-12-17", hours: 0.5, reason: "Traffic delay", department: "Cleaning" },
    { id: 3, staffId: 3, staffName: "Michael Douglas", type: "claims", date: "2025-12-16", hours: 2, reason: "Fuel reimbursement", department: "Transport" },
    { id: 4, staffId: 4, staffName: "Patricia Campbell", type: "overtime", date: "2025-12-15", hours: 4, reason: "Night shift coverage", department: "Security" }
  ];

  /***** Utility: CSV parser (simple, handles quotes) *****/
  function parseCSV(text) {
    const lines = text.split(/\r?\n/);
    const rows = lines.map(line => {
      const result = [];
      let cur = '';
      let inQuotes = false;
      for (let i = 0; i < line.length; i++) {
        const ch = line[i];
        if (ch === '"') {
          if (inQuotes && line[i+1] === '"') { cur += '"'; i++; } else { inQuotes = !inQuotes; }
        } else if (ch === ',' && !inQuotes) {
          result.push(cur);
          cur = '';
        } else {
          cur += ch;
        }
      }
      result.push(cur);
      return result;
    });
    return rows;
  }

  /***** Main App *****/
  function App(){
    // Login state
    const [isLoggedIn, setIsLoggedIn] = useState(false);
    const [loginForm, setLoginForm] = useState({ username: '', password: '' });
    const [loginError, setLoginError] = useState('');
    const [loginLoading, setLoginLoading] = useState(false);
    const [rememberMe, setRememberMe] = useState(false);

    // UI state
    const [activeTab, setActiveTab] = useState('overview');
    const [searchTerm, setSearchTerm] = useState('');
    const [darkMode, setDarkMode] = useState(false);
    const [notifications, setNotifications] = useState(3);
    const [username, setUsername] = useState('Administrator');
    const [loading, setLoading] = useState(false);
    const [lastSync, setLastSync] = useState(null);

    // Data states
    const [departments, setDepartments] = useState([]);
    const [fleetData, setFleetData] = useState([]);
    const [personnelUpdates, setPersonnelUpdates] = useState([]);
    const [totalPatients, setTotalPatients] = useState(0);

    // Form states
    const [newDept, setNewDept] = useState({ name: '', issues: '', barriers: '', recommendations: '', priority: 'Medium' });
    const [newFleet, setNewFleet] = useState({ ambulance: '', inter: 0, intra: 0, fuel: 0, remarks: '' });
    const [newPersonnel, setNewPersonnel] = useState({ title: '', description: '' });

    // Edit modal states
    const [editModal, setEditModal] = useState({ open: false, type: null, index: null, data: null });

    // Toast notification state
    const [toast, setToast] = useState({ show: false, message: '', type: 'success' });

    // Form validation errors
    const [errors, setErrors] = useState({ dept: {}, fleet: {}, personnel: {} });

    // Undo stack for deletions
    const [undoStack, setUndoStack] = useState([]);

    // Charts refs
    const priorityChartRef = useRef(null);
    const tripsChartRef = useRef(null);
    const fleetCompareRef = useRef(null);

    // Staff Management
    const [staffList, setStaffList] = useState([]);
    const [staffSearchTerm, setStaffSearchTerm] = useState('');

    // Leave Management
    const [leaveRecords, setLeaveRecords] = useState([]);
    const [leaveView, setLeaveView] = useState('list'); // 'list' or 'calendar'
    const [leaveFilter, setLeaveFilter] = useState({ department: 'all', type: 'all' });
    const [newLeave, setNewLeave] = useState({ staffId: '', staffName: '', type: 'sick', startDate: '', endDate: '', reason: '', department: '' });

    // Time Tracking
    const [timeRecords, setTimeRecords] = useState([]);
    const [timeFilter, setTimeFilter] = useState({ type: 'all' });
    const [newTimeRecord, setNewTimeRecord] = useState({ staffId: '', staffName: '', type: 'overtime', date: '', hours: 0, reason: '', department: '' });

    // Calendar state
    const [calendarDate, setCalendarDate] = useState(new Date());
    const [selectedDate, setSelectedDate] = useState(null);

    // Notification dropdown
    const [showNotifications, setShowNotifications] = useState(false);
    const [notificationItems, setNotificationItems] = useState([]);

    // Check for saved login session
    useEffect(() => {
      try {
        const savedSession = localStorage.getItem('hospital_session');
        if (savedSession) {
          const session = JSON.parse(savedSession);
          if (session.isLoggedIn && session.username) {
            setIsLoggedIn(true);
            setUsername(session.username);
          }
        }
      } catch (e) {
        console.warn('Failed to load session', e);
      }
    }, []);

    // Load from localStorage if available
    useEffect(() => {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (parsed.departments) setDepartments(parsed.departments);
          if (parsed.fleetData) setFleetData(parsed.fleetData);
          if (parsed.personnelUpdates) setPersonnelUpdates(parsed.personnelUpdates);
          if (typeof parsed.totalPatients === 'number') setTotalPatients(parsed.totalPatients);
          if (typeof parsed.darkMode === 'boolean') setDarkMode(parsed.darkMode);
          if (typeof parsed.notifications === 'number') setNotifications(parsed.notifications);
          // Load new data types
          if (parsed.staffList) setStaffList(parsed.staffList);
          if (parsed.leaveRecords) setLeaveRecords(parsed.leaveRecords);
          if (parsed.timeRecords) setTimeRecords(parsed.timeRecords);
        } else {
          // initialize with defaults until sheet load
          setDepartments(DEFAULT_DEPARTMENTS);
          setFleetData(DEFAULT_FLEET);
          setPersonnelUpdates(DEFAULT_PERSONNEL);
          setTotalPatients(116);
          setStaffList(DEFAULT_STAFF);
          setLeaveRecords(DEFAULT_LEAVE_RECORDS);
          setTimeRecords(DEFAULT_TIME_RECORDS);
        }
      } catch (e) {
        console.warn('Failed to load from localStorage', e);
      }
    }, []);

    // Generate notifications based on leave records
    useEffect(() => {
      const today = new Date();
      const in7Days = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);

      const upcomingLeaves = leaveRecords.filter(leave => {
        const startDate = new Date(leave.startDate);
        return startDate >= today && startDate <= in7Days;
      });

      const newNotifications = upcomingLeaves.map(leave => ({
        id: leave.id,
        type: leave.type === 'sick' ? 'urgent' : 'warning',
        title: `Upcoming ${leave.type} leave`,
        message: `${leave.staffName} - ${leave.startDate}`,
        time: 'Upcoming'
      }));

      // Add high priority department issues
      const urgentDepts = departments.filter(d => d.priority === 'High').slice(0, 2);
      urgentDepts.forEach((dept, idx) => {
        newNotifications.push({
          id: `dept-${idx}`,
          type: 'urgent',
          title: 'High Priority Issue',
          message: dept.name,
          time: 'Active'
        });
      });

      setNotificationItems(newNotifications);
      setNotifications(newNotifications.length);
    }, [leaveRecords, departments]);

    // Auto-save to localStorage whenever the core data changes
    useEffect(() => {
      const payload = {
        departments,
        fleetData,
        personnelUpdates,
        totalPatients,
        darkMode,
        notifications,
        staffList,
        leaveRecords,
        timeRecords
      };
      try {
        localStorage.setItem(LS_KEY, JSON.stringify(payload));
      } catch (e) {
        console.warn('Autosave failed', e);
      }
    }, [departments, fleetData, personnelUpdates, totalPatients, darkMode, notifications, staffList, leaveRecords, timeRecords]);

    // Google Sheet loader (tries to fetch CSV, then merges with local data if present)
    const loadFromGoogleSheet = async () => {
      setLoading(true);
      try {
        const res = await fetch(SHEET_URL);
        if (!res.ok) throw new Error('Network response not ok');
        const csv = await res.text();
        const rows = parseCSV(csv);

        // We'll extract roughly the same rows as original TSX expected
        const depts = [];
        // rows indexing may vary; attempt safe extraction with fallback
        // We'll attempt to find rows that look like department rows by content length
        // but to keep faithful, use previously-known indices (1,3,5,7,9,11,12,13) if present
        const idxs = [1,3,5,7,9,11,12,13];
        idxs.forEach(i => {
          if (rows[i]) {
            // try to map columns to fields
            const row = rows[i];
            const name = row[0] || '';
            const issues = row[1] || '';
            const barriers = row[2] || '';
            const recommendations = row[3] || '';
            // Choose priority based on presence of certain words (fallback to Medium)
            let priority = 'Medium';
            if (/flood|out of commission|delay|insufficient|urgent|critical/i.test(issues + barriers + recommendations)) priority = 'High';
            if (/none|continue/i.test(barriers + recommendations)) priority = 'Low';
            depts.push({ name: name || DEFAULT_DEPARTMENTS[0].name, issues, barriers, recommendations, priority });
          }
        });

        // If no depts parsed, fallback to defaults
        const finalDepts = depts.length ? depts : DEFAULT_DEPARTMENTS;

        // fleet rows indices 17-19
        const fleet = [];
        for (let i = 17; i <= 19; i++) {
          if (rows[i] && rows[i][0]) {
            const ambulance = rows[i][0] || '';
            const inter = parseInt(rows[i][1]) || 0;
            const intra = parseInt(rows[i][2]) || 0;
            const fuel = parseFloat((rows[i][3] || '0').replace(/[^0-9.-]+/g,'')) || 0;
            const remarks = rows[i][4] || '';
            fleet.push({ ambulance, inter, intra, fuel, remarks });
          }
        }
        const finalFleet = fleet.length ? fleet : DEFAULT_FLEET;

        // total patients row 23 (index 23)
        let sheetTotalPatients = null;
        if (rows[23] && rows[23][0]) {
          sheetTotalPatients = parseInt(rows[23][0]) || null;
        }

        // personnel (rows 25-33 area)
        const personnel = [];
        if (rows[25] && rows[25][0]) {
          personnel.push({ title: 'Driver Replacement', description: (rows[25][0] + ' ' + (rows[26] ? rows[26][0] : '')).trim() });
        }
        if (rows[28] && rows[28][0]) {
          personnel.push({ title: 'Commendation', description: rows[28][0] });
        }
        if (rows[30] && rows[30][0]) {
          const trainingDesc = [rows[30][0], rows[31]?.[0], rows[32]?.[0]].filter(Boolean).join(' ');
          personnel.push({ title: 'Training - Mandatory Defensive Driving Workshop', description: trainingDesc });
        }
        const finalPersonnel = personnel.length ? personnel : DEFAULT_PERSONNEL;

        // Merge strategy: prefer local values if present (so local edits persist)
        const rawLocal = localStorage.getItem(LS_KEY);
        if (rawLocal) {
          try {
            const parsed = JSON.parse(rawLocal);
            // If local has arrays with length > 0, use them; otherwise use sheet
            setDepartments((parsed.departments && parsed.departments.length) ? parsed.departments : finalDepts);
            setFleetData((parsed.fleetData && parsed.fleetData.length) ? parsed.fleetData : finalFleet);
            setPersonnelUpdates((parsed.personnelUpdates && parsed.personnelUpdates.length) ? parsed.personnelUpdates : finalPersonnel);
            setTotalPatients((typeof parsed.totalPatients === 'number' && parsed.totalPatients >= 0) ? parsed.totalPatients : (sheetTotalPatients ?? 116));
          } catch (e) {
            // parse failure -> use sheet results
            setDepartments(finalDepts);
            setFleetData(finalFleet);
            setPersonnelUpdates(finalPersonnel);
            setTotalPatients(sheetTotalPatients ?? 116);
          }
        } else {
          // No local -> use sheet results
          setDepartments(finalDepts);
          setFleetData(finalFleet);
          setPersonnelUpdates(finalPersonnel);
          setTotalPatients(sheetTotalPatients ?? 116);
        }

        setLastSync(new Date());
        showToast('Data synchronized with Google Sheet successfully', 'success');
      } catch (err) {
        console.warn('Sheet load failed, using local/defaults', err);
        showToast('Could not load data from Google Sheet - using local data', 'warning');
      } finally {
        setLoading(false);
      }
    };

    // initial attempt to fetch sheet once after mount (but we already loaded local)
    useEffect(() => {
      loadFromGoogleSheet();
    }, []);

    /***** Derived metrics *****/
    const totalTrips = fleetData.reduce((s,i) => s + (parseInt(i.inter)||0) + (parseInt(i.intra)||0), 0);
    const totalFuel = fleetData.reduce((s,i) => s + (parseFloat(i.fuel)||0), 0);

    /***** Charts setup & updates (Chart.js) *****/
    // Priority pie
    useEffect(() => {
      const counts = {
        High: departments.filter(d => d.priority === 'High').length,
        Medium: departments.filter(d => d.priority === 'Medium').length,
        Low: departments.filter(d => d.priority === 'Low').length
      };
      const ctx = priorityChartRef.current;
      if (!ctx) return;
      if (ctx._chartInstance) { ctx._chartInstance.destroy(); ctx._chartInstance = null; }
      ctx._chartInstance = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: ['High Priority','Medium Priority','Low Priority'],
          datasets: [{ data: [counts.High, counts.Medium, counts.Low], backgroundColor: ['#ef4444','#f59e0b','#10b981'] }]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
      });
    }, [departments]);

    // Trips bar (small)
    useEffect(() => {
      const ctx = tripsChartRef.current;
      if (!ctx) return;
      if (ctx._chartInstance) { ctx._chartInstance.destroy(); ctx._chartInstance = null; }
      ctx._chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: fleetData.map(f => f.ambulance),
          datasets: [
            { label: 'Inter-facility', data: fleetData.map(f => f.inter), backgroundColor: '#3b82f6' },
            { label: 'Intra-facility', data: fleetData.map(f => f.intra), backgroundColor: '#8b5cf6' }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
      });
    }, [fleetData]);

    // Fleet compare (large)
    useEffect(() => {
      const ctx = fleetCompareRef.current;
      if (!ctx) return;
      if (ctx._chartInstance) { ctx._chartInstance.destroy(); ctx._chartInstance = null; }
      ctx._chartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: fleetData.map(f => f.ambulance),
          datasets: [
            { label: 'Inter-facility', data: fleetData.map(f => f.inter), backgroundColor: '#3b82f6' },
            { label: 'Intra-facility', data: fleetData.map(f => f.intra), backgroundColor: '#8b5cf6' }
          ]
        },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } }
      });
    }, [fleetData]);

    /***** Toast notification helper *****/
    const showToast = (message, type = 'success') => {
      setToast({ show: true, message, type });
      setTimeout(() => setToast({ show: false, message: '', type: 'success' }), 3000);
    };

    /***** Validation helpers *****/
    const validateDepartment = (dept, excludeIndex = -1) => {
      const errs = {};
      if (!dept.name || dept.name.trim() === '') errs.name = 'Department name is required';
      if (!dept.issues || dept.issues.trim() === '') errs.issues = 'Current issues is required';
      // Check for duplicates
      const duplicate = departments.find((d, i) => i !== excludeIndex && d.name.toLowerCase() === dept.name.toLowerCase());
      if (duplicate) errs.name = 'A department with this name already exists';
      return errs;
    };

    const validateFleet = (fleet, excludeIndex = -1) => {
      const errs = {};
      if (!fleet.ambulance || fleet.ambulance.trim() === '') errs.ambulance = 'Ambulance license is required';
      if (fleet.inter < 0) errs.inter = 'Inter-facility trips cannot be negative';
      if (fleet.intra < 0) errs.intra = 'Intra-facility trips cannot be negative';
      if (fleet.fuel < 0) errs.fuel = 'Fuel cost cannot be negative';
      // Check for duplicates
      const duplicate = fleetData.find((f, i) => i !== excludeIndex && f.ambulance === fleet.ambulance);
      if (duplicate) errs.ambulance = 'This ambulance license already exists';
      return errs;
    };

    const validatePersonnel = (personnel) => {
      const errs = {};
      if (!personnel.title || personnel.title.trim() === '') errs.title = 'Title is required';
      if (!personnel.description || personnel.description.trim() === '') errs.description = 'Description is required';
      return errs;
    };

    /***** Form reset helpers *****/
    const resetDeptForm = () => {
      setNewDept({ name: '', issues: '', barriers: '', recommendations: '', priority: 'Medium' });
      setErrors(prev => ({ ...prev, dept: {} }));
    };

    const resetFleetForm = () => {
      setNewFleet({ ambulance: '', inter: 0, intra: 0, fuel: 0, remarks: '' });
      setErrors(prev => ({ ...prev, fleet: {} }));
    };

    const resetPersonnelForm = () => {
      setNewPersonnel({ title: '', description: '' });
      setErrors(prev => ({ ...prev, personnel: {} }));
    };

    /***** Edit modal helpers *****/
    const openEditModal = (type, index, data) => {
      setEditModal({ open: true, type, index, data: { ...data } });
    };

    const closeEditModal = () => {
      setEditModal({ open: false, type: null, index: null, data: null });
    };

    const saveEdit = () => {
      const { type, index, data } = editModal;

      if (type === 'department') {
        const errs = validateDepartment(data, index);
        if (Object.keys(errs).length > 0) {
          showToast('Please fix validation errors', 'error');
          return;
        }
        setDepartments(prev => prev.map((d, i) => i === index ? { ...data } : d));
        showToast('Department updated successfully', 'success');
      } else if (type === 'fleet') {
        const errs = validateFleet(data, index);
        if (Object.keys(errs).length > 0) {
          showToast('Please fix validation errors', 'error');
          return;
        }
        setFleetData(prev => prev.map((f, i) => i === index ? {
          ...data,
          inter: parseInt(data.inter) || 0,
          intra: parseInt(data.intra) || 0,
          fuel: parseFloat(data.fuel) || 0
        } : f));
        showToast('Fleet vehicle updated successfully', 'success');
      } else if (type === 'personnel') {
        const errs = validatePersonnel(data);
        if (Object.keys(errs).length > 0) {
          showToast('Please fix validation errors', 'error');
          return;
        }
        setPersonnelUpdates(prev => prev.map((p, i) => i === index ? { ...data } : p));
        showToast('Personnel update saved successfully', 'success');
      }

      closeEditModal();
    };

    const updateEditData = (field, value) => {
      setEditModal(prev => ({
        ...prev,
        data: { ...prev.data, [field]: value }
      }));
    };

    /***** Undo functionality *****/
    const undoDelete = () => {
      if (undoStack.length === 0) return;
      const lastAction = undoStack[undoStack.length - 1];

      if (lastAction.type === 'department') {
        setDepartments(prev => {
          const newArr = [...prev];
          newArr.splice(lastAction.index, 0, lastAction.data);
          return newArr;
        });
      } else if (lastAction.type === 'fleet') {
        setFleetData(prev => {
          const newArr = [...prev];
          newArr.splice(lastAction.index, 0, lastAction.data);
          return newArr;
        });
      } else if (lastAction.type === 'personnel') {
        setPersonnelUpdates(prev => {
          const newArr = [...prev];
          newArr.splice(lastAction.index, 0, lastAction.data);
          return newArr;
        });
      }

      setUndoStack(prev => prev.slice(0, -1));
      showToast('Deletion undone', 'info');
    };

    /***** CRUD operations (auto-saved because of effect hooking into state) *****/
    const addDepartment = () => {
      const errs = validateDepartment(newDept);
      setErrors(prev => ({ ...prev, dept: errs }));
      if (Object.keys(errs).length > 0) {
        showToast('Please fix validation errors', 'error');
        return;
      }
      setDepartments(prev => [...prev, {...newDept}]);
      resetDeptForm();
      showToast('Department added successfully', 'success');
      setActiveTab('departments');
    };

    const removeDepartment = (idx) => {
      if (!confirm('Remove this department?')) return;
      const deleted = departments[idx];
      setUndoStack(prev => [...prev, { type: 'department', index: idx, data: deleted }]);
      setDepartments(prev => prev.filter((_,i)=>i!==idx));
      showToast('Department removed. Click Undo to restore.', 'warning');
    };

    const addFleet = () => {
      const errs = validateFleet(newFleet);
      setErrors(prev => ({ ...prev, fleet: errs }));
      if (Object.keys(errs).length > 0) {
        showToast('Please fix validation errors', 'error');
        return;
      }
      setFleetData(prev => [...prev, {...newFleet, inter: parseInt(newFleet.inter)||0, intra: parseInt(newFleet.intra)||0, fuel: parseFloat(newFleet.fuel)||0 }]);
      resetFleetForm();
      showToast('Fleet vehicle added successfully', 'success');
      setActiveTab('fleet');
    };

    const removeFleet = (idx) => {
      if (!confirm('Remove this vehicle?')) return;
      const deleted = fleetData[idx];
      setUndoStack(prev => [...prev, { type: 'fleet', index: idx, data: deleted }]);
      setFleetData(prev => prev.filter((_,i)=>i!==idx));
      showToast('Fleet vehicle removed. Click Undo to restore.', 'warning');
    };

    const addPersonnel = () => {
      const errs = validatePersonnel(newPersonnel);
      setErrors(prev => ({ ...prev, personnel: errs }));
      if (Object.keys(errs).length > 0) {
        showToast('Please fix validation errors', 'error');
        return;
      }
      setPersonnelUpdates(prev => [...prev, {...newPersonnel}]);
      resetPersonnelForm();
      showToast('Personnel update added successfully', 'success');
      setActiveTab('personnel');
    };

    const removePersonnel = (idx) => {
      if (!confirm('Remove this personnel update?')) return;
      const deleted = personnelUpdates[idx];
      setUndoStack(prev => [...prev, { type: 'personnel', index: idx, data: deleted }]);
      setPersonnelUpdates(prev => prev.filter((_,i)=>i!==idx));
      showToast('Personnel update removed. Click Undo to restore.', 'warning');
    };

    const exportToCSV = () => {
      let csv = 'DEPARTMENT,ISSUES,BARRIERS,RECOMMENDATIONS,PRIORITY\n';
      departments.forEach(d => {
        csv += `"${(d.name||'').replace(/"/g,'""')}","${(d.issues||'').replace(/"/g,'""')}","${(d.barriers||'').replace(/"/g,'""')}","${(d.recommendations||'').replace(/"/g,'""')}","${d.priority}"\n`;
      });
      csv += '\nFLEET\nAMBULANCE,INTER,INTRA,FUEL,REMARKS\n';
      fleetData.forEach(f => {
        csv += `"${(f.ambulance||'').replace(/"/g,'""')}",${f.inter||0},${f.intra||0},${f.fuel||0},"${(f.remarks||'').replace(/"/g,'""')}"\n`;
      });
      csv += `\nTOTAL_PATIENTS,${totalPatients}\n\nPERSONNEL\nTITLE,DESCRIPTION\n`;
      personnelUpdates.forEach(p => {
        csv += `"${(p.title||'').replace(/"/g,'""')}","${(p.description||'').replace(/"/g,'""')}"\n`;
      });
      downloadCSV('hospital_report.csv', csv);
      showToast('Data exported to hospital_report.csv', 'success');
    };

    /***** Calendar Helpers *****/
    const getCalendarDays = () => {
      const year = calendarDate.getFullYear();
      const month = calendarDate.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDayOfWeek = firstDay.getDay();
      const daysInMonth = lastDay.getDate();

      const days = [];

      // Previous month days
      const prevMonthLastDay = new Date(year, month, 0).getDate();
      for (let i = startDayOfWeek - 1; i >= 0; i--) {
        days.push({ date: prevMonthLastDay - i, isCurrentMonth: false, fullDate: new Date(year, month - 1, prevMonthLastDay - i) });
      }

      // Current month days
      for (let i = 1; i <= daysInMonth; i++) {
        days.push({ date: i, isCurrentMonth: true, fullDate: new Date(year, month, i) });
      }

      // Next month days to complete the grid
      const remaining = 42 - days.length;
      for (let i = 1; i <= remaining; i++) {
        days.push({ date: i, isCurrentMonth: false, fullDate: new Date(year, month + 1, i) });
      }

      return days;
    };

    const getEventsForDate = (date) => {
      const dateStr = date.toISOString().split('T')[0];
      return leaveRecords.filter(leave => {
        const start = new Date(leave.startDate);
        const end = new Date(leave.endDate);
        const check = new Date(dateStr);
        return check >= start && check <= end;
      });
    };

    const isToday = (date) => {
      const today = new Date();
      return date.getDate() === today.getDate() &&
             date.getMonth() === today.getMonth() &&
             date.getFullYear() === today.getFullYear();
    };

    const navigateCalendar = (direction) => {
      setCalendarDate(prev => {
        const newDate = new Date(prev);
        newDate.setMonth(newDate.getMonth() + direction);
        return newDate;
      });
    };

    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    /***** Leave Management *****/
    const addLeaveRecord = () => {
      if (!newLeave.staffName || !newLeave.startDate || !newLeave.endDate) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      const record = {
        ...newLeave,
        id: Date.now(),
        status: 'pending'
      };
      setLeaveRecords(prev => [...prev, record]);
      setNewLeave({ staffId: '', staffName: '', type: 'sick', startDate: '', endDate: '', reason: '', department: '' });
      showToast('Leave record added successfully', 'success');
    };

    const removeLeaveRecord = (id) => {
      if (!confirm('Remove this leave record?')) return;
      setLeaveRecords(prev => prev.filter(r => r.id !== id));
      showToast('Leave record removed', 'warning');
    };

    const updateLeaveStatus = (id, status) => {
      setLeaveRecords(prev => prev.map(r => r.id === id ? { ...r, status } : r));
      showToast(`Leave ${status}`, 'success');
    };

    const getLeaveTypeLabel = (type) => {
      const labels = { sick: 'Sick Leave', vacation: 'Vacation', dayoff: 'Day Off', departmental: 'Departmental' };
      return labels[type] || type;
    };

    const filteredLeaveRecords = leaveRecords.filter(record => {
      if (leaveFilter.department !== 'all' && record.department !== leaveFilter.department) return false;
      if (leaveFilter.type !== 'all' && record.type !== leaveFilter.type) return false;
      return true;
    });

    /***** Time Tracking *****/
    const addTimeRecord = () => {
      if (!newTimeRecord.staffName || !newTimeRecord.date) {
        showToast('Please fill in all required fields', 'error');
        return;
      }
      const record = {
        ...newTimeRecord,
        id: Date.now(),
        hours: parseFloat(newTimeRecord.hours) || 0
      };
      setTimeRecords(prev => [...prev, record]);
      setNewTimeRecord({ staffId: '', staffName: '', type: 'overtime', date: '', hours: 0, reason: '', department: '' });
      showToast('Time record added successfully', 'success');
    };

    const removeTimeRecord = (id) => {
      if (!confirm('Remove this time record?')) return;
      setTimeRecords(prev => prev.filter(r => r.id !== id));
      showToast('Time record removed', 'warning');
    };

    const getTimeTypeLabel = (type) => {
      const labels = { claims: 'Claims', late: 'Late Arrival', overtime: 'Overtime', dayoff: 'Day Off' };
      return labels[type] || type;
    };

    const filteredTimeRecords = timeRecords.filter(record => {
      if (timeFilter.type !== 'all' && record.type !== timeFilter.type) return false;
      return true;
    });

    const timeStats = {
      claims: timeRecords.filter(r => r.type === 'claims').length,
      late: timeRecords.filter(r => r.type === 'late').length,
      overtime: timeRecords.filter(r => r.type === 'overtime').reduce((sum, r) => sum + (r.hours || 0), 0),
      dayoff: timeRecords.filter(r => r.type === 'dayoff').length
    };

    /***** Reports & Export *****/
    const exportToExcel = () => {
      if (typeof XLSX === 'undefined') {
        showToast('Excel export library not loaded', 'error');
        return;
      }

      const wb = XLSX.utils.book_new();

      // Departments sheet
      const deptData = departments.map(d => ({
        'Department': d.name,
        'Issues': d.issues,
        'Barriers': d.barriers,
        'Recommendations': d.recommendations,
        'Priority': d.priority
      }));
      const deptSheet = XLSX.utils.json_to_sheet(deptData);
      XLSX.utils.book_append_sheet(wb, deptSheet, 'Departments');

      // Fleet sheet
      const fleetSheetData = fleetData.map(f => ({
        'Ambulance': f.ambulance,
        'Inter-facility': f.inter,
        'Intra-facility': f.intra,
        'Total Trips': (f.inter || 0) + (f.intra || 0),
        'Fuel Cost': f.fuel,
        'Remarks': f.remarks
      }));
      const fleetSheet = XLSX.utils.json_to_sheet(fleetSheetData);
      XLSX.utils.book_append_sheet(wb, fleetSheet, 'Fleet');

      // Leave Records sheet
      const leaveData = leaveRecords.map(l => ({
        'Staff Name': l.staffName,
        'Department': l.department,
        'Type': getLeaveTypeLabel(l.type),
        'Start Date': l.startDate,
        'End Date': l.endDate,
        'Reason': l.reason,
        'Status': l.status
      }));
      const leaveSheet = XLSX.utils.json_to_sheet(leaveData);
      XLSX.utils.book_append_sheet(wb, leaveSheet, 'Leave Records');

      // Time Tracking sheet
      const timeData = timeRecords.map(t => ({
        'Staff Name': t.staffName,
        'Department': t.department,
        'Type': getTimeTypeLabel(t.type),
        'Date': t.date,
        'Hours': t.hours,
        'Reason': t.reason
      }));
      const timeSheet = XLSX.utils.json_to_sheet(timeData);
      XLSX.utils.book_append_sheet(wb, timeSheet, 'Time Tracking');

      XLSX.writeFile(wb, 'hospital_report.xlsx');
      showToast('Data exported to hospital_report.xlsx', 'success');
    };

    const exportAllDataJSON = () => {
      const data = {
        departments,
        fleetData,
        personnelUpdates,
        staffList,
        leaveRecords,
        timeRecords,
        totalPatients,
        exportDate: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'hospital_backup.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      showToast('Backup exported successfully', 'success');
    };

    const importDataJSON = (event) => {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = (e) => {
        try {
          const data = JSON.parse(e.target.result);
          if (data.departments) setDepartments(data.departments);
          if (data.fleetData) setFleetData(data.fleetData);
          if (data.personnelUpdates) setPersonnelUpdates(data.personnelUpdates);
          if (data.staffList) setStaffList(data.staffList);
          if (data.leaveRecords) setLeaveRecords(data.leaveRecords);
          if (data.timeRecords) setTimeRecords(data.timeRecords);
          if (typeof data.totalPatients === 'number') setTotalPatients(data.totalPatients);
          showToast('Data imported successfully', 'success');
        } catch (err) {
          showToast('Failed to import data: Invalid format', 'error');
        }
      };
      reader.readAsText(file);
    };

    /***** Login/Logout handlers *****/
    const handleLogin = (e) => {
      e.preventDefault();
      setLoginError('');
      setLoginLoading(true);

      // Simulate authentication delay
      setTimeout(() => {
        // Simple credential check (in production, this would be server-side)
        const validCredentials = [
          { username: 'admin', password: 'admin123' },
          { username: 'administrator', password: 'hospital2025' },
          { username: 'demo', password: 'demo' }
        ];

        const isValid = validCredentials.some(
          cred => cred.username.toLowerCase() === loginForm.username.toLowerCase() &&
                  cred.password === loginForm.password
        );

        if (isValid) {
          setIsLoggedIn(true);
          setUsername(loginForm.username);
          setLoginForm({ username: '', password: '' });

          // Save session if remember me is checked
          if (rememberMe) {
            localStorage.setItem('hospital_session', JSON.stringify({
              isLoggedIn: true,
              username: loginForm.username
            }));
          }

          showToast('Login successful! Welcome back.', 'success');
        } else {
          setLoginError('Invalid username or password. Please try again.');
        }

        setLoginLoading(false);
      }, 800);
    };

    const handleLogout = () => {
      setIsLoggedIn(false);
      setUsername('Administrator');
      setLoginForm({ username: '', password: '' });
      localStorage.removeItem('hospital_session');
      showToast('You have been logged out successfully.', 'info');
    };

    /***** UI render *****/

    // Login Page Component
    if (!isLoggedIn) {
      return (
        <div className={`login-container ${darkMode ? 'dark' : ''}`}>
          <div className={`login-box ${darkMode ? 'bg-gray-800' : ''}`}>
            <div className="login-header">
              <div className="login-icon">ðŸ¥</div>
              <h1>Hospital Administrator</h1>
              <p>Dashboard Management System</p>
            </div>

            <form className="login-form" onSubmit={handleLogin}>
              {loginError && (
                <div className="login-error">
                  <span>âš ï¸</span>
                  <span>{loginError}</span>
                </div>
              )}

              <div className="login-info">
                <span>â„¹ï¸</span>
                <span>Demo: admin / admin123</span>
              </div>

              <div className="login-input-group">
                <label htmlFor="username">Username</label>
                <input
                  type="text"
                  id="username"
                  className={`login-input ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : ''}`}
                  placeholder="Enter your username"
                  value={loginForm.username}
                  onChange={(e) => setLoginForm({ ...loginForm, username: e.target.value })}
                  required
                  autoFocus
                />
              </div>

              <div className="login-input-group">
                <label htmlFor="password">Password</label>
                <input
                  type="password"
                  id="password"
                  className={`login-input ${darkMode ? 'bg-gray-700 border-gray-600 text-white' : ''}`}
                  placeholder="Enter your password"
                  value={loginForm.password}
                  onChange={(e) => setLoginForm({ ...loginForm, password: e.target.value })}
                  required
                />
              </div>

              <label className="remember-me">
                <input
                  type="checkbox"
                  checked={rememberMe}
                  onChange={(e) => setRememberMe(e.target.checked)}
                />
                <span>Remember me</span>
              </label>

              <button type="submit" className="login-btn" disabled={loginLoading}>
                {loginLoading ? (
                  <>
                    <span className="animate-spin">â³</span>
                    <span>Signing in...</span>
                  </>
                ) : (
                  <>
                    <span>ðŸ”</span>
                    <span>Sign In</span>
                  </>
                )}
              </button>
            </form>

            <div className="login-footer">
              <p>Hospital Administrator Dashboard v2.0</p>
              <p style={{ marginTop: '8px' }}>
                <button
                  onClick={() => setDarkMode(!darkMode)}
                  style={{ background: 'none', border: 'none', cursor: 'pointer', color: '#6b7280' }}
                >
                  {darkMode ? 'â˜€ï¸ Light Mode' : 'ðŸŒ™ Dark Mode'}
                </button>
              </p>
            </div>
          </div>
        </div>
      );
    }

    // Main Dashboard
    return (
      <div className={`min-h-screen ${darkMode ? 'dark bg-gray-900 text-white' : ''}`}>
        {/* Navigation Header - Chief Orderly Style */}
        <div className="container mx-auto px-4 py-5">
          <div className={`nav-header ${darkMode ? 'bg-gray-800' : ''}`}>
            {/* Top Row */}
            <div className="flex justify-between items-center mb-5 flex-wrap gap-4">
              {/* Logo & Title */}
              <div className="flex items-center gap-4">
                <div className="main-icon">HA</div>
                <div>
                  <h1 className="text-2xl font-bold text-gray-800" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Hospital Administrator</h1>
                  <p className="text-sm text-gray-500">Dashboard Management System</p>
                </div>
              </div>

              {/* User Info & Actions */}
              <div className="flex items-center gap-3 flex-wrap">
                {lastSync && <div className="text-xs text-gray-500 hidden md:block">Last sync: {lastSync.toLocaleString()}</div>}
                <button onClick={loadFromGoogleSheet} className="btn-secondary px-4 py-2 text-sm flex items-center gap-2">
                  {loading ? 'Syncing...' : 'â†» Sync'}
                </button>
                <button onClick={exportToCSV} className="btn-primary px-4 py-2 text-sm flex items-center gap-2">
                  â†“ Export
                </button>
                <button onClick={() => setDarkMode(!darkMode)} className={`px-3 py-2 rounded-lg font-semibold text-sm transition-all ${darkMode ? 'bg-yellow-500 text-gray-900' : 'bg-gray-700 text-white'}`}>
                  {darkMode ? 'â˜€ Light' : 'â˜¾ Dark'}
                </button>
                <div className="relative">
                  <button
                    onClick={() => setShowNotifications(!showNotifications)}
                    className="w-10 h-10 bg-white rounded-full shadow flex items-center justify-center text-xl hover:scale-110 transition-transform"
                  >
                    ðŸ””
                  </button>
                  {notifications > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">{notifications}</span>}

                  {/* Notification Dropdown */}
                  {showNotifications && (
                    <div className={`notification-dropdown ${darkMode ? 'bg-gray-800' : ''}`}>
                      <div className={`notification-header ${darkMode ? 'bg-gray-700' : ''}`}>
                        <h3 className="font-bold" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Notifications</h3>
                        <button
                          onClick={() => { setNotificationItems([]); setNotifications(0); }}
                          className="text-sm text-blue-500 hover:underline"
                        >
                          Clear All
                        </button>
                      </div>
                      <div className="notification-list">
                        {notificationItems.length === 0 ? (
                          <div className="p-6 text-center text-gray-500">
                            No notifications
                          </div>
                        ) : (
                          notificationItems.map((item, idx) => (
                            <div key={idx} className={`notification-item ${item.type}`}>
                              <div className={`notification-icon ${item.type}`}>
                                {item.type === 'urgent' ? 'ðŸš¨' : item.type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}
                              </div>
                              <div className="flex-1">
                                <p className="font-semibold text-sm" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>{item.title}</p>
                                <p className="text-xs text-gray-500">{item.message}</p>
                                <p className="text-xs text-gray-400 mt-1">{item.time}</p>
                              </div>
                            </div>
                          ))
                        )}
                      </div>
                    </div>
                  )}
                </div>
                <div className="user-info">
                  <div className="w-8 h-8 rounded-full bg-gradient-to-br from-emerald-400 to-cyan-500 flex items-center justify-center text-white font-bold text-sm">
                    {username.charAt(0)}
                  </div>
                  <span className="text-sm font-semibold text-gray-700" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>{username}</span>
                  <button onClick={handleLogout} className="px-3 py-1 bg-red-500 text-white rounded-full text-xs font-semibold hover:bg-red-600 transition-colors">
                    Logout
                  </button>
                </div>
              </div>
            </div>

            {/* Navigation Tabs */}
            <div className={`nav-tabs ${darkMode ? 'bg-gray-700' : ''}`}>
              {[
                { id: 'overview', label: 'ðŸ“Š Overview', icon: 'ðŸ“Š' },
                { id: 'departments', label: 'ðŸ¢ Departments', icon: 'ðŸ¢' },
                { id: 'fleet', label: 'ðŸš‘ Fleet Report', icon: 'ðŸš‘' },
                { id: 'personnel', label: 'ðŸ‘¥ Personnel', icon: 'ðŸ‘¥' },
                { id: 'calendar', label: 'ðŸ“… Calendar', icon: 'ðŸ“…' },
                { id: 'leave', label: 'ðŸ–ï¸ Leave', icon: 'ðŸ–ï¸' },
                { id: 'time-tracking', label: 'â±ï¸ Time Tracking', icon: 'â±ï¸' },
                { id: 'reports', label: 'ðŸ“‹ Reports', icon: 'ðŸ“‹' },
                { id: 'data-entry', label: 'ðŸ“ Data Entry', icon: 'ðŸ“' }
              ].map(tab => (
                <button key={tab.id} onClick={() => setActiveTab(tab.id)}
                  className={`nav-tab ${activeTab===tab.id ? 'active' : ''}`}>
                  {tab.label}
                </button>
              ))}
            </div>
          </div>
        </div>

        {/* Main content */}
        <main className="container mx-auto px-4 py-8 space-y-6">
          {/* Loading overlay */}
          {loading && (
            <div className="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
              <div className="bg-white p-6 rounded shadow">Loading data...</div>
            </div>
          )}

          {/* Toast notification */}
          {toast.show && (
            <div className={`toast ${toast.type}`}>
              <span className="text-lg">{toast.type === 'success' ? 'âœ“' : toast.type === 'error' ? 'âœ•' : toast.type === 'warning' ? 'âš ' : 'â„¹'}</span>
              <span className="font-medium">{toast.message}</span>
              {undoStack.length > 0 && toast.type === 'warning' && (
                <button onClick={undoDelete} className="ml-2 px-3 py-1 bg-white text-gray-800 rounded-lg text-sm font-semibold hover:bg-gray-100 transition-colors">
                  Undo
                </button>
              )}
              <button onClick={() => setToast({ show: false, message: '', type: 'success' })} className="ml-2 text-xl font-bold hover:opacity-70">&times;</button>
            </div>
          )}

          {/* Edit Modal */}
          {editModal.open && (
            <div className="modal-overlay">
              <div className={`modal-content ${darkMode ? 'bg-gray-800' : ''}`}>
                <div className="modal-header">
                  <h2 className="text-xl font-bold" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>
                    âœï¸ Edit {editModal.type === 'department' ? 'Department' : editModal.type === 'fleet' ? 'Fleet Vehicle' : 'Personnel Update'}
                  </h2>
                  <button onClick={closeEditModal} className="icon-btn delete text-2xl">&times;</button>
                </div>

                <div className="p-6 space-y-4">
                  {editModal.type === 'department' && editModal.data && (
                    <>
                      <div>
                        <label className="block text-sm font-medium mb-1">Department Name *</label>
                        <input type="text" value={editModal.data.name || ''} onChange={(e) => updateEditData('name', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`} />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Current Issues *</label>
                        <textarea rows="3" value={editModal.data.issues || ''} onChange={(e) => updateEditData('issues', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`}></textarea>
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Barriers</label>
                        <textarea rows="2" value={editModal.data.barriers || ''} onChange={(e) => updateEditData('barriers', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`}></textarea>
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Recommendations</label>
                        <textarea rows="2" value={editModal.data.recommendations || ''} onChange={(e) => updateEditData('recommendations', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`}></textarea>
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Priority</label>
                        <select value={editModal.data.priority || 'Medium'} onChange={(e) => updateEditData('priority', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`}>
                          <option value="Low">Low Priority</option>
                          <option value="Medium">Medium Priority</option>
                          <option value="High">High Priority</option>
                        </select>
                      </div>
                    </>
                  )}

                  {editModal.type === 'fleet' && editModal.data && (
                    <>
                      <div>
                        <label className="block text-sm font-medium mb-1">Ambulance License Number *</label>
                        <input type="text" value={editModal.data.ambulance || ''} onChange={(e) => updateEditData('ambulance', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`} />
                      </div>
                      <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                          <label className="block text-sm font-medium mb-1">Inter-facility Trips</label>
                          <input type="number" min="0" value={editModal.data.inter || 0} onChange={(e) => updateEditData('inter', parseInt(e.target.value) || 0)}
                            className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`} />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Intra-facility Trips</label>
                          <input type="number" min="0" value={editModal.data.intra || 0} onChange={(e) => updateEditData('intra', parseInt(e.target.value) || 0)}
                            className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`} />
                        </div>
                        <div>
                          <label className="block text-sm font-medium mb-1">Fuel Cost ($)</label>
                          <input type="number" min="0" step="0.01" value={editModal.data.fuel || 0} onChange={(e) => updateEditData('fuel', parseFloat(e.target.value) || 0)}
                            className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`} />
                        </div>
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Remarks</label>
                        <textarea rows="2" value={editModal.data.remarks || ''} onChange={(e) => updateEditData('remarks', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`}></textarea>
                      </div>
                    </>
                  )}

                  {editModal.type === 'personnel' && editModal.data && (
                    <>
                      <div>
                        <label className="block text-sm font-medium mb-1">Update Title *</label>
                        <input type="text" value={editModal.data.title || ''} onChange={(e) => updateEditData('title', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`} />
                      </div>
                      <div>
                        <label className="block text-sm font-medium mb-1">Description *</label>
                        <textarea rows="4" value={editModal.data.description || ''} onChange={(e) => updateEditData('description', e.target.value)}
                          className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : 'border-gray-300'}`}></textarea>
                      </div>
                    </>
                  )}
                </div>

                <div className={`p-4 border-t ${darkMode ? 'border-gray-700' : 'border-gray-200'} flex justify-end gap-3`}>
                  <button onClick={closeEditModal} className={`px-4 py-2 rounded ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>
                    Cancel
                  </button>
                  <button onClick={saveEdit} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                    Save Changes
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Overview */}
          {activeTab === 'overview' && (
            <section className="space-y-6 animate-fadeIn">
              {/* Connection Status */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`} style={{background: darkMode ? '' : 'linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%)'}}>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <span className="text-2xl">{lastSync ? 'âœ…' : 'â³'}</span>
                    <div>
                      <div className="font-semibold" style={{color: darkMode ? '#f3f4f6' : '#065f46'}}>{ lastSync ? 'Connected to Google Sheets' : 'Attempting to connect to Google Sheets' }</div>
                      <div className="text-sm text-gray-500">{ lastSync ? `Last updated: ${lastSync.toLocaleString()}` : 'Loading...' }</div>
                    </div>
                  </div>
                  <button onClick={loadFromGoogleSheet} className="btn-primary px-4 py-2 text-sm">â†» Refresh Data</button>
                </div>
              </div>

              {/* Key metrics */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div className={`stat-card blue ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500 mb-1">Total Departments</p>
                      <p className="text-3xl font-bold" style={{color: '#0ea5e9'}}>{departments.length}</p>
                    </div>
                    <span className="text-4xl opacity-20">ðŸ¢</span>
                  </div>
                </div>
                <div className={`stat-card green ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500 mb-1">Total Ambulance Trips</p>
                      <p className="text-3xl font-bold" style={{color: '#10b981'}}>{totalTrips}</p>
                    </div>
                    <span className="text-4xl opacity-20">ðŸš‘</span>
                  </div>
                </div>
                <div className={`stat-card purple ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500 mb-1">Patients Transported</p>
                      <p className="text-3xl font-bold" style={{color: '#a855f7'}}>{totalPatients}</p>
                    </div>
                    <span className="text-4xl opacity-20">ðŸ‘¥</span>
                  </div>
                </div>
                <div className={`stat-card red ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500 mb-1">High Priority Issues</p>
                      <p className="text-3xl font-bold" style={{color: '#ef4444'}}>{departments.filter(d=>d.priority==='High').length}</p>
                    </div>
                    <span className="text-4xl opacity-20">âš ï¸</span>
                  </div>
                </div>
              </div>

              {/* Charts */}
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h3 className="font-bold mb-4 text-lg" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ“Š Issues by Priority</h3>
                  <div className="chart-container">
                    <canvas ref={priorityChartRef}></canvas>
                  </div>
                </div>

                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h3 className="font-bold mb-4 text-lg" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ“ˆ Ambulance Trip Distribution</h3>
                  <div className="chart-container">
                    <canvas ref={tripsChartRef}></canvas>
                  </div>
                </div>
              </div>

              {/* Executive summary */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <h3 className="font-bold mb-4 text-lg" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ“‹ Executive Summary</h3>
                <div className="grid md:grid-cols-2 gap-6">
                  <div className="border-l-4 border-red-500 pl-4 py-3 rounded-r-lg" style={{background: 'rgba(239, 68, 68, 0.05)'}}>
                    <h4 className="font-bold text-red-600 mb-3 flex items-center gap-2">ðŸš¨ Critical Issues</h4>
                    <ul className="text-sm space-y-2">
                      {departments.filter(d=>d.priority==='High').slice(0,3).map((d,i)=>(<li key={i} className="flex items-start gap-2"><span className="text-red-500">â€¢</span> {d.name}</li>))}
                    </ul>
                  </div>
                  <div className="border-l-4 border-green-500 pl-4 py-3 rounded-r-lg" style={{background: 'rgba(16, 185, 129, 0.05)'}}>
                    <h4 className="font-bold text-green-600 mb-3 flex items-center gap-2">âœ… Positive Updates</h4>
                    <ul className="text-sm space-y-2">
                      <li className="flex items-start gap-2"><span className="text-green-500">â€¢</span> {totalPatients} patients transported successfully</li>
                      <li className="flex items-start gap-2"><span className="text-green-500">â€¢</span> {fleetData.length} ambulances in active service</li>
                      <li className="flex items-start gap-2"><span className="text-green-500">â€¢</span> {departments.filter(d=>d.priority==='Low').length} departments performing well</li>
                    </ul>
                  </div>
                </div>
              </div>
            </section>
          )}

          {/* Departments */}
          {activeTab === 'departments' && (
            <section className="space-y-6">
              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-4 rounded shadow`}>
                <div className="relative">
                  <input value={searchTerm} onChange={(e)=>setSearchTerm(e.target.value)} placeholder="Search departments, issues, or barriers..." className="w-full pl-4 pr-4 py-2 border rounded" />
                </div>
              </div>

              <div className="grid gap-6">
                {departments.filter(d => d.name.toLowerCase().includes(searchTerm.toLowerCase()) || d.issues.toLowerCase().includes(searchTerm.toLowerCase()))
                  .map((dept, idx) => (
                  <div key={idx} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded shadow overflow-hidden`}>
                    <div className={`p-4 ${dept.priority==='High' ? 'border-l-4 border-red-500 bg-red-50' : dept.priority==='Medium' ? 'border-l-4 border-yellow-500 bg-yellow-50' : 'border-l-4 border-green-500 bg-green-50'}`}>
                      <div className="flex justify-between">
                        <h3 className="font-semibold">{dept.name}</h3>
                        <span className="px-3 py-1 rounded-full text-xs font-semibold">
                          {dept.priority} Priority
                        </span>
                      </div>
                    </div>
                    <div className="p-6 space-y-3">
                      <div>
                        <h4 className="font-semibold">Current Issues</h4>
                        <p className="text-sm">{dept.issues}</p>
                      </div>
                      {dept.barriers && dept.barriers !== 'None' && (
                        <div>
                          <h4 className="font-semibold">Barriers</h4>
                          <p className="text-sm">{dept.barriers}</p>
                        </div>
                      )}
                      <div>
                        <h4 className="font-semibold">Recommendations</h4>
                        <p className="text-sm">{dept.recommendations}</p>
                      </div>
                      <div className="flex justify-end gap-2">
                        <button onClick={() => openEditModal('department', departments.indexOf(dept), dept)} className="px-3 py-2 text-blue-500 hover:bg-blue-50 rounded">Edit</button>
                        <button onClick={()=>removeDepartment(departments.indexOf(dept))} className="px-3 py-2 text-red-500 hover:bg-red-50 rounded">Remove</button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </section>
          )}

          {/* Fleet */}
          {activeTab === 'fleet' && (
            <section className="space-y-6">
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                  <h4 className="text-sm">Total Trips</h4>
                  <p className="text-3xl font-bold text-blue-600">{totalTrips}</p>
                  <p className="text-xs mt-1">Inter: {fleetData.reduce((s,i)=>s+(parseInt(i.inter)||0),0)} | Intra: {fleetData.reduce((s,i)=>s+(parseInt(i.intra)||0),0)}</p>
                </div>
                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                  <h4 className="text-sm">Patients Transported</h4>
                  <p className="text-3xl font-bold text-green-600">{totalPatients}</p>
                </div>
                <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                  <h4 className="text-sm">Total Fuel Cost</h4>
                  <p className="text-3xl font-bold text-purple-600">${totalFuel.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}</p>
                </div>
              </div>

              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded shadow overflow-hidden`}>
                <div className="p-6">
                  <h3 className="font-semibold mb-4">Ambulance Fleet Details</h3>
                  <div className="overflow-x-auto">
                    <table className="min-w-full">
                      <thead className={`${darkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                        <tr>
                          <th className="px-4 py-2 text-left text-xs">License #</th>
                          <th className="px-4 py-2 text-left text-xs">Inter-facility</th>
                          <th className="px-4 py-2 text-left text-xs">Intra-facility</th>
                          <th className="px-4 py-2 text-left text-xs">Total Trips</th>
                          <th className="px-4 py-2 text-left text-xs">Fuel Cost</th>
                          <th className="px-4 py-2 text-left text-xs">Remarks</th>
                          <th className="px-4 py-2 text-left text-xs">Action</th>
                        </tr>
                      </thead>
                      <tbody>
                        {fleetData.map((v, i) => (
                          <tr key={i} className="hover:bg-gray-50">
                            <td className="px-4 py-2">{v.ambulance}</td>
                            <td className="px-4 py-2">{v.inter}</td>
                            <td className="px-4 py-2">{v.intra}</td>
                            <td className="px-4 py-2 font-semibold">{(parseInt(v.inter)||0)+(parseInt(v.intra)||0)}</td>
                            <td className="px-4 py-2">${(parseFloat(v.fuel)||0).toLocaleString(undefined,{minimumFractionDigits:2})}</td>
                            <td className="px-4 py-2">{v.remarks||'-'}</td>
                            <td className="px-4 py-2">
                              <button onClick={() => openEditModal('fleet', i, v)} className="text-blue-500 mr-2 hover:underline">Edit</button>
                              <button onClick={()=>removeFleet(i)} className="text-red-500 hover:underline">Remove</button>
                            </td>
                          </tr>
                        ))}
                        <tr className="font-semibold bg-blue-50">
                          <td className="px-4 py-2">TOTAL</td>
                          <td className="px-4 py-2">{fleetData.reduce((s,i)=>s+(parseInt(i.inter)||0),0)}</td>
                          <td className="px-4 py-2">{fleetData.reduce((s,i)=>s+(parseInt(i.intra)||0),0)}</td>
                          <td className="px-4 py-2">{totalTrips}</td>
                          <td className="px-4 py-2">${totalFuel.toLocaleString(undefined,{minimumFractionDigits:2})}</td>
                          <td className="px-4 py-2">-</td>
                          <td></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>

              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                <h3 className="font-semibold mb-4">Trip Comparison by Ambulance</h3>
                <div className="chart-container">
                  <canvas ref={fleetCompareRef}></canvas>
                </div>
              </div>
            </section>
          )}

          {/* Personnel */}
          {activeTab === 'personnel' && (
            <section className="space-y-6">
              {personnelUpdates.map((u,i)=>(
                <div key={i} className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                  <div className="flex items-start gap-4">
                    <div className={`${darkMode ? 'bg-blue-700' : 'bg-blue-100'} rounded-full p-3`}>U</div>
                    <div className="flex-1">
                      <h3 className="font-semibold">{u.title}</h3>
                      <p className="text-sm">{u.description}</p>
                    </div>
                    <div className="flex gap-2">
                      <button onClick={() => openEditModal('personnel', i, u)} className="text-blue-500 hover:underline">Edit</button>
                      <button onClick={()=>removePersonnel(i)} className="text-red-500 hover:underline">Remove</button>
                    </div>
                  </div>
                </div>
              ))}
            </section>
          )}

          {/* Calendar */}
          {activeTab === 'calendar' && (
            <section className="space-y-6 animate-fadeIn">
              <div className={`calendar-container ${darkMode ? 'bg-gray-800' : ''}`}>
                <div className="calendar-header">
                  <button onClick={() => navigateCalendar(-1)} className="calendar-nav-btn">â—€</button>
                  <h2 className="text-xl font-bold">
                    {monthNames[calendarDate.getMonth()]} {calendarDate.getFullYear()}
                  </h2>
                  <button onClick={() => navigateCalendar(1)} className="calendar-nav-btn">â–¶</button>
                </div>

                <div className="calendar-grid">
                  {/* Day headers */}
                  {dayNames.map(day => (
                    <div key={day} className={`calendar-day-header ${darkMode ? 'bg-gray-700' : ''}`}>{day}</div>
                  ))}

                  {/* Calendar days */}
                  {getCalendarDays().map((day, idx) => {
                    const events = getEventsForDate(day.fullDate);
                    return (
                      <div
                        key={idx}
                        className={`calendar-day ${!day.isCurrentMonth ? 'other-month' : ''} ${isToday(day.fullDate) ? 'today' : ''}`}
                        onClick={() => setSelectedDate(day.fullDate)}
                      >
                        <div className="calendar-day-number">{day.date}</div>
                        {events.slice(0, 3).map((event, eIdx) => (
                          <div key={eIdx} className={`calendar-event ${event.type}`}>
                            {event.staffName}
                          </div>
                        ))}
                        {events.length > 3 && (
                          <div className="text-xs text-gray-500">+{events.length - 3} more</div>
                        )}
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Selected Date Details */}
              {selectedDate && (
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h3 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>
                    ðŸ“… {selectedDate.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                  </h3>
                  {getEventsForDate(selectedDate).length === 0 ? (
                    <p className="text-gray-500">No events scheduled for this date.</p>
                  ) : (
                    <div className="space-y-3">
                      {getEventsForDate(selectedDate).map((event, idx) => (
                        <div key={idx} className={`p-4 rounded-lg border-l-4 ${
                          event.type === 'sick' ? 'border-red-500 bg-red-50' :
                          event.type === 'vacation' ? 'border-purple-500 bg-purple-50' :
                          event.type === 'dayoff' ? 'border-yellow-500 bg-yellow-50' :
                          'border-blue-500 bg-blue-50'
                        }`}>
                          <div className="flex justify-between items-start">
                            <div>
                              <p className="font-semibold">{event.staffName}</p>
                              <p className="text-sm text-gray-600">{event.department}</p>
                            </div>
                            <span className={`leave-badge ${event.type}`}>{getLeaveTypeLabel(event.type)}</span>
                          </div>
                          <p className="text-sm mt-2">{event.reason}</p>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* Calendar Legend */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <h3 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Legend</h3>
                <div className="flex flex-wrap gap-4">
                  <div className="flex items-center gap-2"><span className="w-4 h-4 rounded bg-red-200"></span> Sick Leave</div>
                  <div className="flex items-center gap-2"><span className="w-4 h-4 rounded bg-purple-200"></span> Vacation</div>
                  <div className="flex items-center gap-2"><span className="w-4 h-4 rounded bg-yellow-200"></span> Day Off</div>
                  <div className="flex items-center gap-2"><span className="w-4 h-4 rounded bg-blue-200"></span> Departmental</div>
                </div>
              </div>
            </section>
          )}

          {/* Leave Management */}
          {activeTab === 'leave' && (
            <section className="space-y-6 animate-fadeIn">
              {/* View Toggle & Filters */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <div className="flex flex-wrap justify-between items-center gap-4">
                  <div className={`view-toggle ${darkMode ? 'bg-gray-700' : ''}`}>
                    <button className={leaveView === 'list' ? 'active' : ''} onClick={() => setLeaveView('list')}>ðŸ“‹ List View</button>
                    <button className={leaveView === 'calendar' ? 'active' : ''} onClick={() => setLeaveView('calendar')}>ðŸ“… Calendar View</button>
                  </div>
                  <div className="flex gap-3">
                    <select
                      value={leaveFilter.type}
                      onChange={(e) => setLeaveFilter({...leaveFilter, type: e.target.value})}
                      className={`px-3 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                    >
                      <option value="all">All Types</option>
                      <option value="sick">Sick Leave</option>
                      <option value="vacation">Vacation</option>
                      <option value="dayoff">Day Off</option>
                      <option value="departmental">Departmental</option>
                    </select>
                  </div>
                </div>
              </div>

              {/* Stats Cards */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div className={`stat-card red ${darkMode ? 'bg-gray-800' : ''}`}>
                  <p className="text-sm text-gray-500">Sick Leave</p>
                  <p className="text-3xl font-bold" style={{color: '#ef4444'}}>{leaveRecords.filter(r => r.type === 'sick').length}</p>
                </div>
                <div className={`stat-card purple ${darkMode ? 'bg-gray-800' : ''}`}>
                  <p className="text-sm text-gray-500">Vacation</p>
                  <p className="text-3xl font-bold" style={{color: '#a855f7'}}>{leaveRecords.filter(r => r.type === 'vacation').length}</p>
                </div>
                <div className={`stat-card blue ${darkMode ? 'bg-gray-800' : ''}`}>
                  <p className="text-sm text-gray-500">Day Off</p>
                  <p className="text-3xl font-bold" style={{color: '#f59e0b'}}>{leaveRecords.filter(r => r.type === 'dayoff').length}</p>
                </div>
                <div className={`stat-card green ${darkMode ? 'bg-gray-800' : ''}`}>
                  <p className="text-sm text-gray-500">Departmental</p>
                  <p className="text-3xl font-bold" style={{color: '#0ea5e9'}}>{leaveRecords.filter(r => r.type === 'departmental').length}</p>
                </div>
              </div>

              {/* Add Leave Form */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <h3 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Add Leave Record</h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <input
                    type="text"
                    placeholder="Staff Name *"
                    value={newLeave.staffName}
                    onChange={(e) => setNewLeave({...newLeave, staffName: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <input
                    type="text"
                    placeholder="Department"
                    value={newLeave.department}
                    onChange={(e) => setNewLeave({...newLeave, department: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <select
                    value={newLeave.type}
                    onChange={(e) => setNewLeave({...newLeave, type: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  >
                    <option value="sick">Sick Leave</option>
                    <option value="vacation">Vacation</option>
                    <option value="dayoff">Day Off</option>
                    <option value="departmental">Departmental</option>
                  </select>
                  <input
                    type="date"
                    value={newLeave.startDate}
                    onChange={(e) => setNewLeave({...newLeave, startDate: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <input
                    type="date"
                    value={newLeave.endDate}
                    onChange={(e) => setNewLeave({...newLeave, endDate: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <input
                    type="text"
                    placeholder="Reason"
                    value={newLeave.reason}
                    onChange={(e) => setNewLeave({...newLeave, reason: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                </div>
                <button onClick={addLeaveRecord} className="btn-primary mt-4">Add Leave Record</button>
              </div>

              {/* Leave List View */}
              {leaveView === 'list' && (
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h3 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Leave Records ({filteredLeaveRecords.length})</h3>
                  {filteredLeaveRecords.length === 0 ? (
                    <p className="text-gray-500 text-center py-8">No leave records found.</p>
                  ) : (
                    <div className="space-y-3">
                      {filteredLeaveRecords.map((record) => (
                        <div key={record.id} className={`p-4 rounded-lg border ${darkMode ? 'border-gray-700' : 'border-gray-200'} flex flex-wrap justify-between items-center gap-4`}>
                          <div className="flex items-center gap-4">
                            <div className={`staff-avatar`} style={{background: 'linear-gradient(135deg, #10b981, #0ea5e9)'}}>
                              {record.staffName.charAt(0)}
                            </div>
                            <div>
                              <p className="font-semibold">{record.staffName}</p>
                              <p className="text-sm text-gray-500">{record.department}</p>
                            </div>
                          </div>
                          <div className="text-center">
                            <p className="text-sm font-medium">{record.startDate} to {record.endDate}</p>
                            <p className="text-xs text-gray-500">{record.reason}</p>
                          </div>
                          <div className="flex items-center gap-3">
                            <span className={`leave-badge ${record.type}`}>{getLeaveTypeLabel(record.type)}</span>
                            <span className={`px-2 py-1 rounded text-xs font-semibold ${
                              record.status === 'approved' ? 'bg-green-100 text-green-700' :
                              record.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :
                              'bg-red-100 text-red-700'
                            }`}>{record.status}</span>
                          </div>
                          <div className="flex gap-2">
                            {record.status === 'pending' && (
                              <>
                                <button onClick={() => updateLeaveStatus(record.id, 'approved')} className="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">Approve</button>
                                <button onClick={() => updateLeaveStatus(record.id, 'rejected')} className="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">Reject</button>
                              </>
                            )}
                            <button onClick={() => removeLeaveRecord(record.id)} className="px-3 py-1 bg-gray-200 text-gray-700 rounded text-sm hover:bg-gray-300">Remove</button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* Leave Calendar View */}
              {leaveView === 'calendar' && (
                <div className={`calendar-container ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="calendar-header">
                    <button onClick={() => navigateCalendar(-1)} className="calendar-nav-btn">â—€</button>
                    <h2 className="text-xl font-bold">
                      {monthNames[calendarDate.getMonth()]} {calendarDate.getFullYear()}
                    </h2>
                    <button onClick={() => navigateCalendar(1)} className="calendar-nav-btn">â–¶</button>
                  </div>
                  <div className="calendar-grid">
                    {dayNames.map(day => (
                      <div key={day} className={`calendar-day-header ${darkMode ? 'bg-gray-700' : ''}`}>{day}</div>
                    ))}
                    {getCalendarDays().map((day, idx) => {
                      const events = getEventsForDate(day.fullDate);
                      return (
                        <div
                          key={idx}
                          className={`calendar-day ${!day.isCurrentMonth ? 'other-month' : ''} ${isToday(day.fullDate) ? 'today' : ''}`}
                        >
                          <div className="calendar-day-number">{day.date}</div>
                          {events.slice(0, 2).map((event, eIdx) => (
                            <div key={eIdx} className={`calendar-event ${event.type}`}>
                              {event.staffName}
                            </div>
                          ))}
                          {events.length > 2 && (
                            <div className="text-xs text-gray-500">+{events.length - 2} more</div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                </div>
              )}
            </section>
          )}

          {/* Time Tracking */}
          {activeTab === 'time-tracking' && (
            <section className="space-y-6 animate-fadeIn">
              {/* Stats Cards */}
              <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div className={`time-card claims ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500">Claims</p>
                      <p className="text-3xl font-bold" style={{color: '#3b82f6'}}>{timeStats.claims}</p>
                    </div>
                    <span className="text-3xl opacity-30">ðŸ“‹</span>
                  </div>
                </div>
                <div className={`time-card late ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500">Late Arrivals</p>
                      <p className="text-3xl font-bold" style={{color: '#ef4444'}}>{timeStats.late}</p>
                    </div>
                    <span className="text-3xl opacity-30">â°</span>
                  </div>
                </div>
                <div className={`time-card overtime ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500">Overtime Hours</p>
                      <p className="text-3xl font-bold" style={{color: '#10b981'}}>{timeStats.overtime}h</p>
                    </div>
                    <span className="text-3xl opacity-30">â±ï¸</span>
                  </div>
                </div>
                <div className={`time-card dayoff ${darkMode ? 'bg-gray-800' : ''}`}>
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-gray-500">Days Off</p>
                      <p className="text-3xl font-bold" style={{color: '#f59e0b'}}>{timeStats.dayoff}</p>
                    </div>
                    <span className="text-3xl opacity-30">ðŸ–ï¸</span>
                  </div>
                </div>
              </div>

              {/* Filter */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <div className="flex flex-wrap justify-between items-center gap-4">
                  <h3 className="font-bold" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Time Records</h3>
                  <select
                    value={timeFilter.type}
                    onChange={(e) => setTimeFilter({type: e.target.value})}
                    className={`px-3 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  >
                    <option value="all">All Types</option>
                    <option value="claims">Claims</option>
                    <option value="late">Late Arrivals</option>
                    <option value="overtime">Overtime</option>
                    <option value="dayoff">Day Off</option>
                  </select>
                </div>
              </div>

              {/* Add Time Record Form */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <h3 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>Add Time Record</h3>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <input
                    type="text"
                    placeholder="Staff Name *"
                    value={newTimeRecord.staffName}
                    onChange={(e) => setNewTimeRecord({...newTimeRecord, staffName: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <input
                    type="text"
                    placeholder="Department"
                    value={newTimeRecord.department}
                    onChange={(e) => setNewTimeRecord({...newTimeRecord, department: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <select
                    value={newTimeRecord.type}
                    onChange={(e) => setNewTimeRecord({...newTimeRecord, type: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  >
                    <option value="overtime">Overtime</option>
                    <option value="late">Late Arrival</option>
                    <option value="claims">Claims</option>
                    <option value="dayoff">Day Off</option>
                  </select>
                  <input
                    type="date"
                    value={newTimeRecord.date}
                    onChange={(e) => setNewTimeRecord({...newTimeRecord, date: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <input
                    type="number"
                    placeholder="Hours"
                    min="0"
                    step="0.5"
                    value={newTimeRecord.hours}
                    onChange={(e) => setNewTimeRecord({...newTimeRecord, hours: parseFloat(e.target.value) || 0})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                  <input
                    type="text"
                    placeholder="Reason/Notes"
                    value={newTimeRecord.reason}
                    onChange={(e) => setNewTimeRecord({...newTimeRecord, reason: e.target.value})}
                    className={`form-input ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}
                  />
                </div>
                <button onClick={addTimeRecord} className="btn-primary mt-4">Add Time Record</button>
              </div>

              {/* Time Records List */}
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <div className="overflow-x-auto">
                  <table className="data-table">
                    <thead>
                      <tr>
                        <th>Staff Name</th>
                        <th>Department</th>
                        <th>Type</th>
                        <th>Date</th>
                        <th>Hours</th>
                        <th>Reason</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody>
                      {filteredTimeRecords.length === 0 ? (
                        <tr><td colSpan="7" className="text-center py-8 text-gray-500">No time records found.</td></tr>
                      ) : (
                        filteredTimeRecords.map((record) => (
                          <tr key={record.id}>
                            <td className="font-medium">{record.staffName}</td>
                            <td>{record.department || '-'}</td>
                            <td>
                              <span className={`px-2 py-1 rounded text-xs font-semibold ${
                                record.type === 'overtime' ? 'bg-green-100 text-green-700' :
                                record.type === 'late' ? 'bg-red-100 text-red-700' :
                                record.type === 'claims' ? 'bg-blue-100 text-blue-700' :
                                'bg-yellow-100 text-yellow-700'
                              }`}>{getTimeTypeLabel(record.type)}</span>
                            </td>
                            <td>{record.date}</td>
                            <td>{record.hours}h</td>
                            <td>{record.reason || '-'}</td>
                            <td>
                              <button onClick={() => removeTimeRecord(record.id)} className="text-red-500 hover:underline">Remove</button>
                            </td>
                          </tr>
                        ))
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            </section>
          )}

          {/* Reports */}
          {activeTab === 'reports' && (
            <section className="space-y-6 animate-fadeIn">
              <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                <h3 className="font-bold mb-6 text-xl" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ“Š Reports & Export</h3>

                {/* Quick Stats */}
                <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                  <div className="text-center p-4 rounded-lg bg-gradient-to-br from-blue-50 to-blue-100">
                    <p className="text-3xl font-bold text-blue-600">{departments.length}</p>
                    <p className="text-sm text-gray-600">Departments</p>
                  </div>
                  <div className="text-center p-4 rounded-lg bg-gradient-to-br from-green-50 to-green-100">
                    <p className="text-3xl font-bold text-green-600">{staffList.length}</p>
                    <p className="text-sm text-gray-600">Staff Members</p>
                  </div>
                  <div className="text-center p-4 rounded-lg bg-gradient-to-br from-purple-50 to-purple-100">
                    <p className="text-3xl font-bold text-purple-600">{leaveRecords.length}</p>
                    <p className="text-sm text-gray-600">Leave Records</p>
                  </div>
                  <div className="text-center p-4 rounded-lg bg-gradient-to-br from-orange-50 to-orange-100">
                    <p className="text-3xl font-bold text-orange-600">{timeRecords.length}</p>
                    <p className="text-sm text-gray-600">Time Records</p>
                  </div>
                </div>

                {/* Export Options */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className={`p-6 rounded-lg border-2 border-dashed ${darkMode ? 'border-gray-600' : 'border-gray-300'}`}>
                    <h4 className="font-bold mb-3" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ“¤ Export Data</h4>
                    <p className="text-sm text-gray-500 mb-4">Download your data in various formats for external use or backup.</p>
                    <div className="space-y-3">
                      <button onClick={exportToCSV} className="w-full btn-primary flex items-center justify-center gap-2">
                        ðŸ“„ Export to CSV
                      </button>
                      <button onClick={exportToExcel} className="w-full btn-secondary flex items-center justify-center gap-2">
                        ðŸ“Š Export to Excel
                      </button>
                      <button onClick={exportAllDataJSON} className="w-full px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 flex items-center justify-center gap-2">
                        ðŸ’¾ Backup All Data (JSON)
                      </button>
                    </div>
                  </div>

                  <div className={`p-6 rounded-lg border-2 border-dashed ${darkMode ? 'border-gray-600' : 'border-gray-300'}`}>
                    <h4 className="font-bold mb-3" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ“¥ Import Data</h4>
                    <p className="text-sm text-gray-500 mb-4">Restore data from a previously exported JSON backup file.</p>
                    <label className="w-full px-4 py-3 bg-blue-50 border-2 border-blue-200 rounded-lg cursor-pointer hover:bg-blue-100 flex items-center justify-center gap-2 text-blue-600 font-semibold">
                      ðŸ“‚ Select Backup File
                      <input type="file" accept=".json" onChange={importDataJSON} className="hidden" />
                    </label>
                    <p className="text-xs text-gray-400 mt-3">Only .json backup files are supported</p>
                  </div>
                </div>
              </div>

              {/* Report Summaries */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {/* Department Summary */}
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h4 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ¢ Department Summary</h4>
                  <div className="space-y-2">
                    <div className="flex justify-between"><span>High Priority Issues:</span><span className="font-bold text-red-500">{departments.filter(d => d.priority === 'High').length}</span></div>
                    <div className="flex justify-between"><span>Medium Priority Issues:</span><span className="font-bold text-yellow-500">{departments.filter(d => d.priority === 'Medium').length}</span></div>
                    <div className="flex justify-between"><span>Low Priority Issues:</span><span className="font-bold text-green-500">{departments.filter(d => d.priority === 'Low').length}</span></div>
                  </div>
                </div>

                {/* Fleet Summary */}
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h4 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸš‘ Fleet Summary</h4>
                  <div className="space-y-2">
                    <div className="flex justify-between"><span>Total Vehicles:</span><span className="font-bold">{fleetData.length}</span></div>
                    <div className="flex justify-between"><span>Total Trips:</span><span className="font-bold text-blue-500">{fleetData.reduce((s,f) => s + (f.inter||0) + (f.intra||0), 0)}</span></div>
                    <div className="flex justify-between"><span>Total Fuel Cost:</span><span className="font-bold text-purple-500">${fleetData.reduce((s,f) => s + (f.fuel||0), 0).toLocaleString()}</span></div>
                  </div>
                </div>

                {/* Leave Summary */}
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h4 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>ðŸ–ï¸ Leave Summary</h4>
                  <div className="space-y-2">
                    <div className="flex justify-between"><span>Pending Approvals:</span><span className="font-bold text-yellow-500">{leaveRecords.filter(l => l.status === 'pending').length}</span></div>
                    <div className="flex justify-between"><span>Approved:</span><span className="font-bold text-green-500">{leaveRecords.filter(l => l.status === 'approved').length}</span></div>
                    <div className="flex justify-between"><span>Rejected:</span><span className="font-bold text-red-500">{leaveRecords.filter(l => l.status === 'rejected').length}</span></div>
                  </div>
                </div>

                {/* Time Summary */}
                <div className={`dashboard-card ${darkMode ? 'bg-gray-800' : ''}`}>
                  <h4 className="font-bold mb-4" style={{color: darkMode ? '#f3f4f6' : '#1a202c'}}>â±ï¸ Time Tracking Summary</h4>
                  <div className="space-y-2">
                    <div className="flex justify-between"><span>Total Overtime Hours:</span><span className="font-bold text-green-500">{timeStats.overtime}h</span></div>
                    <div className="flex justify-between"><span>Late Arrivals:</span><span className="font-bold text-red-500">{timeStats.late}</span></div>
                    <div className="flex justify-between"><span>Claims Filed:</span><span className="font-bold text-blue-500">{timeStats.claims}</span></div>
                  </div>
                </div>
              </div>
            </section>
          )}

          {/* Data Entry */}
          {activeTab === 'data-entry' && (
            <section className="space-y-6">
              <div className={`${darkMode ? 'bg-yellow-900' : 'bg-yellow-50'} p-4 rounded border`}>Note: Data saved automatically to Local Storage. Use Export to download CSV.</div>

              {/* Department Entry */}
              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                <h3 className="font-semibold mb-4">Add Department</h3>
                <div className="space-y-3">
                  <div>
                    <input type="text" placeholder="Department Name *" value={newDept.name} onChange={(e)=>setNewDept({...newDept,name:e.target.value})}
                      className={`w-full px-4 py-2 border rounded ${errors.dept.name ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                    {errors.dept.name && <p className="text-red-500 text-sm mt-1">{errors.dept.name}</p>}
                  </div>
                  <div>
                    <textarea rows="3" placeholder="Current Issues *" value={newDept.issues} onChange={(e)=>setNewDept({...newDept,issues:e.target.value})}
                      className={`w-full px-4 py-2 border rounded ${errors.dept.issues ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}></textarea>
                    {errors.dept.issues && <p className="text-red-500 text-sm mt-1">{errors.dept.issues}</p>}
                  </div>
                  <textarea rows="2" placeholder="Barriers" value={newDept.barriers} onChange={(e)=>setNewDept({...newDept,barriers:e.target.value})}
                    className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}></textarea>
                  <textarea rows="2" placeholder="Recommendations" value={newDept.recommendations} onChange={(e)=>setNewDept({...newDept,recommendations:e.target.value})}
                    className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}></textarea>
                  <select value={newDept.priority} onChange={(e)=>setNewDept({...newDept,priority:e.target.value})}
                    className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}>
                    <option value="Low">Low Priority</option>
                    <option value="Medium">Medium Priority</option>
                    <option value="High">High Priority</option>
                  </select>
                  <div className="flex gap-3">
                    <button onClick={addDepartment} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save Department</button>
                    <button onClick={resetDeptForm} className={`px-4 py-2 rounded ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>Clear Form</button>
                  </div>
                </div>

                <div className="mt-6">
                  <h4 className="font-semibold">Current Departments ({departments.length})</h4>
                  <div className="space-y-2 mt-2">
                    {departments.map((d,i)=>(
                      <div key={i} className={`p-3 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} flex justify-between items-center`}>
                        <div className="flex-1">
                          <span className="font-medium">{d.name}</span>
                          <span className={`ml-2 text-xs px-2 py-1 rounded ${d.priority === 'High' ? 'bg-red-100 text-red-700' : d.priority === 'Medium' ? 'bg-yellow-100 text-yellow-700' : 'bg-green-100 text-green-700'}`}>{d.priority}</span>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => openEditModal('department', i, d)} className="text-blue-500 hover:underline">Edit</button>
                          <button onClick={()=>removeDepartment(i)} className="text-red-500 hover:underline">Remove</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Fleet Entry */}
              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                <h3 className="font-semibold mb-4">Add Fleet Vehicle</h3>
                <div className="space-y-3">
                  <div>
                    <input type="text" placeholder="Ambulance License Number *" value={newFleet.ambulance} onChange={(e)=>setNewFleet({...newFleet,ambulance:e.target.value})}
                      className={`w-full px-4 py-2 border rounded ${errors.fleet.ambulance ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                    {errors.fleet.ambulance && <p className="text-red-500 text-sm mt-1">{errors.fleet.ambulance}</p>}
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div>
                      <input type="number" min="0" placeholder="Inter-facility Trips" value={newFleet.inter} onChange={(e)=>setNewFleet({...newFleet,inter:parseInt(e.target.value)||0})}
                        className={`w-full px-4 py-2 border rounded ${errors.fleet.inter ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                      {errors.fleet.inter && <p className="text-red-500 text-sm mt-1">{errors.fleet.inter}</p>}
                    </div>
                    <div>
                      <input type="number" min="0" placeholder="Intra-facility Trips" value={newFleet.intra} onChange={(e)=>setNewFleet({...newFleet,intra:parseInt(e.target.value)||0})}
                        className={`w-full px-4 py-2 border rounded ${errors.fleet.intra ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                      {errors.fleet.intra && <p className="text-red-500 text-sm mt-1">{errors.fleet.intra}</p>}
                    </div>
                    <div>
                      <input type="number" min="0" step="0.01" placeholder="Fuel Cost ($)" value={newFleet.fuel} onChange={(e)=>setNewFleet({...newFleet,fuel:parseFloat(e.target.value)||0})}
                        className={`w-full px-4 py-2 border rounded ${errors.fleet.fuel ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                      {errors.fleet.fuel && <p className="text-red-500 text-sm mt-1">{errors.fleet.fuel}</p>}
                    </div>
                  </div>
                  <textarea rows="2" placeholder="Remarks" value={newFleet.remarks} onChange={(e)=>setNewFleet({...newFleet,remarks:e.target.value})}
                    className={`w-full px-4 py-2 border rounded ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}></textarea>
                  <div className="flex gap-3">
                    <button onClick={addFleet} className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600">Save Fleet Vehicle</button>
                    <button onClick={resetFleetForm} className={`px-4 py-2 rounded ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>Clear Form</button>
                  </div>
                </div>

                <div className="mt-6">
                  <h4 className="font-semibold">Current Fleet ({fleetData.length})</h4>
                  <div className="space-y-2 mt-2">
                    {fleetData.map((f,i)=>(
                      <div key={i} className={`p-3 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} flex justify-between items-center`}>
                        <div className="flex-1">
                          <span className="font-medium">Ambulance {f.ambulance}</span>
                          <span className="ml-2 text-sm text-gray-500">{(parseInt(f.inter)||0)+(parseInt(f.intra)||0)} trips | ${(parseFloat(f.fuel)||0).toLocaleString()}</span>
                        </div>
                        <div className="flex gap-2">
                          <button onClick={() => openEditModal('fleet', i, f)} className="text-blue-500 hover:underline">Edit</button>
                          <button onClick={()=>removeFleet(i)} className="text-red-500 hover:underline">Remove</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Personnel Entry */}
              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                <h3 className="font-semibold mb-4">Add Personnel Update</h3>
                <div className="space-y-3">
                  <div>
                    <input type="text" placeholder="Update Title *" value={newPersonnel.title} onChange={(e)=>setNewPersonnel({...newPersonnel,title:e.target.value})}
                      className={`w-full px-4 py-2 border rounded ${errors.personnel.title ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                    {errors.personnel.title && <p className="text-red-500 text-sm mt-1">{errors.personnel.title}</p>}
                  </div>
                  <div>
                    <textarea rows="4" placeholder="Description *" value={newPersonnel.description} onChange={(e)=>setNewPersonnel({...newPersonnel,description:e.target.value})}
                      className={`w-full px-4 py-2 border rounded ${errors.personnel.description ? 'border-red-500' : ''} ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}></textarea>
                    {errors.personnel.description && <p className="text-red-500 text-sm mt-1">{errors.personnel.description}</p>}
                  </div>
                  <div className="flex gap-3">
                    <button onClick={addPersonnel} className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600">Save Personnel Update</button>
                    <button onClick={resetPersonnelForm} className={`px-4 py-2 rounded ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>Clear Form</button>
                  </div>
                </div>

                <div className="mt-6">
                  <h4 className="font-semibold">Current Updates ({personnelUpdates.length})</h4>
                  <div className="space-y-2 mt-2">
                    {personnelUpdates.map((p,i)=>(
                      <div key={i} className={`p-3 rounded ${darkMode ? 'bg-gray-700' : 'bg-gray-50'} flex justify-between items-center`}>
                        <span className="font-medium">{p.title}</span>
                        <div className="flex gap-2">
                          <button onClick={() => openEditModal('personnel', i, p)} className="text-blue-500 hover:underline">Edit</button>
                          <button onClick={()=>removePersonnel(i)} className="text-red-500 hover:underline">Remove</button>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Total Patients */}
              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                <h3 className="font-semibold mb-4">Update Total Patients Transported</h3>
                <div className="flex gap-3">
                  <input type="number" min="0" value={totalPatients} onChange={(e)=>setTotalPatients(parseInt(e.target.value)||0)}
                    className={`px-4 py-2 border rounded flex-1 ${darkMode ? 'bg-gray-700 border-gray-600' : ''}`}/>
                  <button onClick={()=>showToast('Patient count updated successfully!', 'success')} className="px-4 py-2 bg-indigo-500 text-white rounded hover:bg-indigo-600">Update</button>
                </div>
                <p className="text-sm text-gray-500 mt-2">Changes are saved automatically to local storage.</p>
              </div>

              {/* Data Management Actions */}
              <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} p-6 rounded shadow`}>
                <h3 className="font-semibold mb-4">Data Management</h3>
                <div className="flex flex-wrap gap-3">
                  <button onClick={exportToCSV} className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Export All Data to CSV</button>
                  <button onClick={loadFromGoogleSheet} className={`px-4 py-2 rounded ${darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-200 hover:bg-gray-300'}`}>
                    {loading ? 'Refreshing...' : 'Refresh from Google Sheet'}
                  </button>
                  <button onClick={() => {
                    if (confirm('Are you sure you want to clear all local data? This cannot be undone.')) {
                      localStorage.removeItem(LS_KEY);
                      setDepartments(DEFAULT_DEPARTMENTS);
                      setFleetData(DEFAULT_FLEET);
                      setPersonnelUpdates(DEFAULT_PERSONNEL);
                      setTotalPatients(116);
                      showToast('Local data cleared. Defaults restored.', 'info');
                    }
                  }} className="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Reset to Defaults</button>
                </div>
                <p className="text-sm text-gray-500 mt-3">
                  {lastSync ? `Last synchronized: ${lastSync.toLocaleString()}` : 'Not yet synchronized with Google Sheet'}
                </p>
              </div>
            </section>
          )}
        </main>
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById('root')).render(<App />);

  </script>
</body>
</html>
