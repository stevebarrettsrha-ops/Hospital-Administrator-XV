<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Management System - Complete</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #6ee7b7 0%, #7dd3fc 100%);
            min-height: 100vh;
            padding: 20px;
            transition: background 0.3s ease;
        }

        /* Dark Mode */
        body.dark-mode {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
        }

        .dark-mode .nav-header,
        .dark-mode .dashboard-card,
        .dark-mode .stat-card,
        .dark-mode .modal-content,
        .dark-mode .kpi-card {
            background: #1e293b;
            color: #f1f5f9;
        }

        .dark-mode .data-table th {
            background: #0f172a;
            color: #f1f5f9;
        }

        .dark-mode .data-table tr:hover {
            background: #334155;
        }

        .dark-mode .form-input,
        .dark-mode .form-select,
        .dark-mode .form-textarea {
            background: #0f172a;
            color: #f1f5f9;
            border-color: #334155;
        }

        .dark-mode .section-title,
        .dark-mode .activity-name,
        .dark-mode .calendar-title {
            color: #f1f5f9;
        }

        .dark-mode .calendar-day {
            color: #f1f5f9;
        }

        .dark-mode .fleet-card {
            background: #1e293b;
            border-color: #334155;
        }

        .dark-mode .update-card {
            background: #1e293b;
            border-color: #334155;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Loading Spinner */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #10b981;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Navigation */
        .nav-header {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease;
        }

        .nav-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-title h1 {
            color: #1a202c;
            font-size: 28px;
        }

        .dark-mode .nav-title h1 {
            color: #f1f5f9;
        }

        .main-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
        }

        .nav-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            background: #f7fafc;
            padding: 6px;
            border-radius: 10px;
            flex-wrap: wrap;
        }

        .dark-mode .nav-tabs {
            background: #0f172a;
        }

        .nav-tab {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            background: transparent;
            color: #718096;
        }

        .nav-tab:hover {
            color: #1a202c;
            background: #e2e8f0;
        }

        .dark-mode .nav-tab:hover {
            color: #f1f5f9;
            background: #334155;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #10b981 0%, #0ea5e9 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        /* Cards */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border-left: 4px solid;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .stat-card.blue { border-left-color: #0ea5e9; }
        .stat-card.green { border-left-color: #10b981; }
        .stat-card.purple { border-left-color: #a855f7; }
        .stat-card.red { border-left-color: #ef4444; }
        .stat-card.orange { border-left-color: #f97316; }
        .stat-card.yellow { border-left-color: #eab308; }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .stat-label {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
        }

        .stat-subtext {
            font-size: 12px;
            color: #64748b;
            margin-top: 4px;
        }

        .stat-icon {
            font-size: 36px;
        }

        .dashboard-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .dashboard-card:hover {
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        /* Grid Layouts */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .two-col-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        /* Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .data-table th {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            padding: 12px;
            text-align: left;
            font-weight: 700;
            color: #334155;
            border-bottom: 2px solid #e2e8f0;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
        }

        .data-table tr:hover {
            background: #f8fafc;
        }

        .table-container {
            overflow-x: auto;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-green { background: #d1fae5; color: #065f46; }
        .badge-yellow { background: #fef3c7; color: #92400e; }
        .badge-red { background: #fee2e2; color: #991b1b; }
        .badge-blue { background: #dbeafe; color: #1e40af; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #1a202c;
        }

        .dark-mode .form-label {
            color: #f1f5f9;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .form-textarea {
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        /* Calendar */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-title {
            font-size: 20px;
            font-weight: bold;
            color: #1a202c;
        }

        .calendar-day-name {
            text-align: center;
            font-weight: 700;
            padding: 8px;
            color: #64748b;
            font-size: 12px;
            text-transform: uppercase;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 500;
            position: relative;
            border: 2px solid transparent;
            background: white;
        }

        .dark-mode .calendar-day {
            background: #1e293b;
        }

        .calendar-day:hover {
            background: #f0f9ff;
        }

        .dark-mode .calendar-day:hover {
            background: #334155;
        }

        .calendar-day.has-schedule {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            font-weight: 700;
        }

        .dark-mode .calendar-day.has-schedule {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
        }

        .calendar-day.has-leave {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            font-weight: 700;
        }

        .calendar-day.today {
            border-color: #10b981;
            font-weight: 700;
        }

        .schedule-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 10px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .leave-count {
            position: absolute;
            bottom: 2px;
            right: 2px;
            font-size: 10px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Activity Item */
        .activity-item {
            padding: 12px;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-name {
            font-weight: 600;
            color: #1a202c;
        }

        .activity-detail {
            font-size: 12px;
            color: #64748b;
        }

        /* Utility Classes */
        .hidden { display: none; }
        .mb-20 { margin-bottom: 20px; }
        .mb-30 { margin-bottom: 30px; }
        .text-center { text-align: center; }
        .font-bold { font-weight: bold; }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #1a202c;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* KPI Card */
        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
        }

        .kpi-card.blue { border-left-color: #0ea5e9; }
        .kpi-card.green { border-left-color: #10b981; }
        .kpi-card.purple { border-left-color: #a855f7; }
        .kpi-card.orange { border-left-color: #f97316; }

        .kpi-title {
            font-weight: 600;
            font-size: 14px;
            color: #64748b;
            margin-bottom: 12px;
        }

        .kpi-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .kpi-value {
            font-weight: bold;
        }

        /* Fleet Card */
        .fleet-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }

        .fleet-card:hover {
            border-color: #10b981;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
        }

        .fleet-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }

        .fleet-id {
            font-size: 20px;
            font-weight: bold;
            color: #1a202c;
        }

        .dark-mode .fleet-id {
            color: #f1f5f9;
        }

        .fleet-info {
            margin-bottom: 12px;
        }

        .fleet-label {
            color: #64748b;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .fleet-value {
            font-weight: 600;
            font-size: 14px;
            color: #1a202c;
        }

        .dark-mode .fleet-value {
            color: #f1f5f9;
        }

        .fleet-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        /* Update Card */
        .update-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
            transition: all 0.3s;
        }

        .update-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
        }

        .update-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .update-title {
            font-size: 18px;
            font-weight: bold;
            color: #1a202c;
        }

        .dark-mode .update-title {
            color: #f1f5f9;
        }

        .update-date {
            font-size: 12px;
            color: #64748b;
        }

        .update-content {
            color: #334155;
            font-size: 14px;
            line-height: 1.6;
        }

        .dark-mode .update-content {
            color: #cbd5e1;
        }

        .update-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 12px;
        }

        .update-type-info { background: #dbeafe; color: #1e40af; }
        .update-type-warning { background: #fef3c7; color: #92400e; }
        .update-type-issue { background: #fee2e2; color: #991b1b; }

        /* Schedule List */
        .schedule-list {
            margin-top: 20px;
        }

        .schedule-item {
            background: #f8fafc;
            border-left: 4px solid #10b981;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .dark-mode .schedule-item {
            background: #0f172a;
        }

        .schedule-staff-name {
            font-weight: 700;
            font-size: 16px;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .dark-mode .schedule-staff-name {
            color: #f1f5f9;
        }

        .schedule-details {
            font-size: 14px;
            color: #64748b;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        /* Print Styles */
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
            .print-area {
                display: block !important;
            }
            .dashboard-card, .stat-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }

        .print-area {
            display: none;
        }

        .print-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #10b981;
        }

        .print-header h1 {
            font-size: 28px;
            color: #1a202c;
            margin-bottom: 10px;
        }

        .print-header p {
            color: #64748b;
            font-size: 14px;
        }

        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .print-table th {
            background: #f8fafc;
            padding: 12px;
            text-align: left;
            font-weight: 700;
            color: #334155;
            border: 1px solid #e2e8f0;
        }

        .print-table td {
            padding: 12px;
            border: 1px solid #e2e8f0;
        }

        .print-table tr:nth-child(even) {
            background: #f8fafc;
        }

        .print-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .print-summary-item {
            text-align: center;
        }

        .print-summary-value {
            font-size: 32px;
            font-weight: bold;
            color: #10b981;
        }

        .print-summary-label {
            font-size: 14px;
            color: #64748b;
            margin-top: 8px;
        }

        /* Floating Button */
        .floating-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 50px;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.4);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
        }

        .floating-btn:hover {
            transform: translateY(-4px) scale(1.05);
            box-shadow: 0 12px 32px rgba(99, 102, 241, 0.5);
        }

        /* Alert */
        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
            z-index: 2000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        .dark-mode .alert {
            background: #1e293b;
            color: #f1f5f9;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .two-col-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-title h1 {
                font-size: 20px;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }

            .print-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* File Input */
        .file-input-label {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            color: white;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }

        .file-input {
            display: none;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading-container">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: white; font-weight: 600;">Loading Hospital Management System...</p>
    </div>

    <div id="app" class="hidden"></div>

    <!-- Print Area -->
    <div id="printArea" class="print-area"></div>

    <script>
        // ============ CONFIGURATION ============
        const CONFIG = {
            USE_GOOGLE_SHEETS: false,
            SCRIPT_URL: '', // Add your Google Apps Script URL here
            SYNC_ENABLED: false
        };

        // ============ DATA STORAGE ============
        const StorageManager = {
            get(key) {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set(key, value) {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        // ============ INITIAL DATA ============
        const initialStaff = [
            { id: 1, trn: '001', name: 'John Smith', department: 'Emergency', position: 'Senior Porter', phone: '876-555-0101', email: 'john.smith@hospital.com', status: 'active', vacationDays: 20, sickDays: 10, personalDays: 5 },
            { id: 2, trn: '002', name: 'Sarah Johnson', department: 'Surgery', position: 'Porter', phone: '876-555-0102', email: 'sarah.j@hospital.com', status: 'active', vacationDays: 18, sickDays: 12, personalDays: 5 },
            { id: 3, trn: '003', name: 'Michael Brown', department: 'ICU', position: 'Porter', phone: '876-555-0103', email: 'michael.b@hospital.com', status: 'active', vacationDays: 15, sickDays: 10, personalDays: 3 },
            { id: 4, trn: '004', name: 'Emily Davis', department: 'Pediatrics', position: 'Junior Porter', phone: '876-555-0104', email: 'emily.d@hospital.com', status: 'active', vacationDays: 22, sickDays: 8, personalDays: 5 },
        ];

        const initialDepartments = [
            { id: 1, name: 'Emergency', employees: 12, status: 'active', head: 'Dr. Anderson' },
            { id: 2, name: 'Surgery', employees: 8, status: 'active', head: 'Dr. Martinez' },
            { id: 3, name: 'ICU', employees: 15, status: 'active', head: 'Dr. Thompson' },
            { id: 4, name: 'Pediatrics', employees: 10, status: 'active', head: 'Dr. Wilson' },
        ];

        // ============ APPLICATION STATE ============
        class AppState {
            constructor() {
                this.activeTab = 'dashboard';
                this.darkMode = localStorage.getItem('darkMode') === 'true';
                this.staff = StorageManager.get('hospital_staff') || initialStaff;
                this.departments = StorageManager.get('hospital_departments') || initialDepartments;
                this.fleet = StorageManager.get('hospital_fleet') || [];
                this.leaveRecords = StorageManager.get('hospital_leave_records') || [];
                this.timeTrackingRecords = StorageManager.get('hospital_time_tracking') || [];
                this.scheduleData = StorageManager.get('hospital_schedules') || {};
                this.hospitalUpdates = StorageManager.get('hospital_updates') || [];
                this.modalOpen = false;
                this.modalType = '';
                this.editingItem = null;
                this.calendarDate = new Date();
                this.selectedDate = null;
            }

            save() {
                StorageManager.set('hospital_staff', this.staff);
                StorageManager.set('hospital_departments', this.departments);
                StorageManager.set('hospital_fleet', this.fleet);
                StorageManager.set('hospital_leave_records', this.leaveRecords);
                StorageManager.set('hospital_time_tracking', this.timeTrackingRecords);
                StorageManager.set('hospital_schedules', this.scheduleData);
                StorageManager.set('hospital_updates', this.hospitalUpdates);
            }

            toggleDarkMode() {
                this.darkMode = !this.darkMode;
                localStorage.setItem('darkMode', this.darkMode);
                document.body.classList.toggle('dark-mode', this.darkMode);
            }

            getStats() {
                return {
                    totalStaff: this.staff.length,
                    activeStaff: this.staff.filter(s => s.status === 'active').length,
                    pendingLeave: this.leaveRecords.filter(l => l.status === 'pending').length,
                    approvedLeave: this.leaveRecords.filter(l => l.status === 'approved').length,
                    claimsCount: this.timeTrackingRecords.filter(t => t.type === 'claims').length,
                    lateCount: this.timeTrackingRecords.filter(t => t.type === 'late').length,
                    overtimeHours: this.timeTrackingRecords
                        .filter(t => t.type === 'overtime')
                        .reduce((sum, t) => sum + (t.hours || 0), 0),
                    totalTrips: this.fleet.reduce((sum, v) => sum + (v.totalTrips || 0), 0),
                    activeVehicles: this.fleet.filter(v => v.status === 'active').length,
                    totalUpdates: this.hospitalUpdates.length,
                };
            }
        }

        const state = new AppState();

        // Apply dark mode on load
        if (state.darkMode) {
            document.body.classList.add('dark-mode');
        }

        // ============ UI HELPERS ============
        function showAlert(message) {
            const alert = document.createElement('div');
            alert.className = 'alert';
            alert.textContent = message;
            document.body.appendChild(alert);
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function formatDateTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // ============ RENDER FUNCTIONS ============
        function render() {
            const app = document.getElementById('app');
            const loading = document.getElementById('loading');
            
            loading.classList.add('hidden');
            app.classList.remove('hidden');

            app.innerHTML = `
                <div class="container">
                    ${renderNav()}
                    ${renderContent()}
                    ${renderModal()}
                </div>
                ${renderFloatingButton()}
            `;
        }

        function renderNav() {
            return `
                <div class="nav-header">
                    <div class="nav-top">
                        <div class="nav-title">
                            <div class="main-icon">üè•</div>
                            <h1>Hospital Management System</h1>
                        </div>
                        <div class="nav-actions">
                            <button class="btn btn-primary" onclick="toggleDarkMode()" title="Toggle Dark Mode">
                                ${state.darkMode ? '‚òÄÔ∏è Light' : 'üåô Dark'}
                            </button>
                            <button class="btn btn-secondary" onclick="syncData()" title="Sync with Google Sheets">
                                üîÑ Sync
                            </button>
                            <button class="btn btn-secondary" onclick="exportToExcel()">
                                üìä Export
                            </button>
                            <label class="file-input-label" style="padding: 12px 20px; font-size: 14px;">
                                üì• Import
                                <input type="file" class="file-input" accept=".xlsx,.xls,.json" onchange="importData(event)">
                            </label>
                        </div>
                    </div>
                    <div class="nav-tabs">
                        ${renderTab('dashboard', 'üìä Dashboard')}
                        ${renderTab('staff', 'üë• Staff')}
                        ${renderTab('leave', 'üèñÔ∏è Leave')}
                        ${renderTab('calendar', 'üìÖ Calendar')}
                        ${renderTab('timetracking', '‚è±Ô∏è Time Tracking')}
                        ${renderTab('fleet', 'üöó Fleet')}
                        ${renderTab('updates', 'üì¢ Updates')}
                        ${renderTab('reports', 'üìà Reports')}
                    </div>
                </div>
            `;
        }

        function renderTab(tabName, label) {
            const isActive = state.activeTab === tabName;
            return `<button class="nav-tab ${isActive ? 'active' : ''}" onclick="switchTab('${tabName}')">${label}</button>`;
        }

        function renderContent() {
            switch(state.activeTab) {
                case 'dashboard': return renderDashboard();
                case 'staff': return renderStaff();
                case 'leave': return renderLeave();
                case 'calendar': return renderCalendar();
                case 'timetracking': return renderTimeTracking();
                case 'fleet': return renderFleet();
                case 'updates': return renderUpdates();
                case 'reports': return renderReports();
                default: return renderDashboard();
            }
        }

        function renderDashboard() {
            const stats = state.getStats();
            return `
                <div>
                    <h2 class="section-title mb-20">üìä Dashboard Overview</h2>
                    
                    <div class="stats-grid">
                        ${renderStatCard('blue', 'üë•', 'Total Staff', stats.totalStaff, `Active: ${stats.activeStaff}`)}
                        ${renderStatCard('green', 'üèñÔ∏è', 'Leave Requests', stats.pendingLeave, 'Pending Approval')}
                        ${renderStatCard('purple', '‚è∞', 'Overtime Hours', stats.overtimeHours.toFixed(1), 'This Month')}
                        ${renderStatCard('red', '‚è±Ô∏è', 'Late Arrivals', stats.lateCount, 'This Month')}
                        ${renderStatCard('orange', 'üöó', 'Fleet Trips', stats.totalTrips, `${stats.activeVehicles} Active Vehicles`)}
                        ${renderStatCard('yellow', 'üì¢', 'Hospital Updates', stats.totalUpdates, 'View All Updates')}
                    </div>

                    <div class="two-col-grid">
                        ${renderRecentLeave()}
                        ${renderRecentTimeTracking()}
                    </div>
                </div>
            `;
        }

        function renderStatCard(color, icon, label, value, subtext) {
            return `
                <div class="stat-card ${color}">
                    <div class="stat-header">
                        <div>
                            <p class="stat-label">${label}</p>
                            <p class="stat-value">${value}</p>
                            <p class="stat-subtext">${subtext}</p>
                        </div>
                        <div class="stat-icon">${icon}</div>
                    </div>
                </div>
            `;
        }

        function renderRecentLeave() {
            const recent = state.leaveRecords.slice(0, 5);
            return `
                <div class="dashboard-card">
                    <h3 class="font-bold mb-20">üìã Recent Leave Requests</h3>
                    ${recent.length === 0 ? '<p style="color: #64748b;">No leave requests yet</p>' : 
                        recent.map(leave => `
                            <div class="activity-item">
                                <div>
                                    <p class="activity-name">${leave.employeeName}</p>
                                    <p class="activity-detail">${formatDate(leave.startDate)} to ${formatDate(leave.endDate)}</p>
                                </div>
                                <span class="badge badge-${leave.status === 'approved' ? 'green' : leave.status === 'pending' ? 'yellow' : 'red'}">
                                    ${leave.status}
                                </span>
                            </div>
                        `).join('')
                    }
                </div>
            `;
        }

        function renderRecentTimeTracking() {
            const recent = state.timeTrackingRecords.slice(0, 5);
            const typeIcons = { claims: 'üí∞', late: '‚è±Ô∏è', dayoff: 'üìÖ', overtime: '‚è∞' };
            const typeNames = { claims: 'Claims', late: 'Late', dayoff: 'Day Off', overtime: 'Overtime' };
            
            return `
                <div class="dashboard-card">
                    <h3 class="font-bold mb-20">‚è±Ô∏è Recent Time Tracking</h3>
                    ${recent.length === 0 ? '<p style="color: #64748b;">No time tracking records yet</p>' :
                        recent.map(record => `
                            <div class="activity-item">
                                <div>
                                    <p class="activity-name">${record.staffName}</p>
                                    <p class="activity-detail">${typeIcons[record.type]} ${typeNames[record.type]} - ${formatDate(record.date)}</p>
                                </div>
                                ${record.type === 'claims' && record.amount ? `<span style="font-weight: bold; color: #f59e0b;">$${record.amount}</span>` : ''}
                                ${(record.type === 'late' || record.type === 'overtime') && record.hours ? `<span style="font-weight: bold; color: #10b981;">${record.hours}h</span>` : ''}
                            </div>
                        `).join('')
                    }
                </div>
            `;
        }

        function renderStaff() {
            return `
                <div>
                    <div class="section-header">
                        <h2 class="section-title">üë• Staff Management</h2>
                        <button class="btn btn-primary" onclick="openModal('addStaff')">‚ûï Add Staff Member</button>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>TRN</th>
                                        <th>Name</th>
                                        <th>Department</th>
                                        <th>Position</th>
                                        <th>Phone</th>
                                        <th>Email</th>
                                        <th>Status</th>
                                        <th class="no-print">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${state.staff.map(s => `
                                        <tr>
                                            <td style="font-weight: 700;">${s.trn}</td>
                                            <td style="font-weight: 600;">${s.name}</td>
                                            <td>${s.department}</td>
                                            <td>${s.position}</td>
                                            <td>${s.phone}</td>
                                            <td>${s.email}</td>
                                            <td><span class="badge badge-${s.status === 'active' ? 'green' : 'red'}">${s.status}</span></td>
                                            <td class="no-print">
                                                <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" onclick="editStaff(${s.id})">Edit</button>
                                                <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="deleteStaff(${s.id})">Delete</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderLeave() {
            return `
                <div>
                    <div class="section-header">
                        <h2 class="section-title">üèñÔ∏è Leave Management</h2>
                        <button class="btn btn-primary" onclick="openModal('addLeave')">‚ûï Request Leave</button>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Employee</th>
                                        <th>Department</th>
                                        <th>Type</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Days</th>
                                        <th>Status</th>
                                        <th class="no-print">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${state.leaveRecords.map(leave => `
                                        <tr>
                                            <td style="font-weight: 600;">${leave.employeeName}</td>
                                            <td>${leave.department}</td>
                                            <td>${leave.type}</td>
                                            <td>${formatDate(leave.startDate)}</td>
                                            <td>${formatDate(leave.endDate)}</td>
                                            <td style="font-weight: bold;">${leave.days}</td>
                                            <td><span class="badge badge-${leave.status === 'approved' ? 'green' : leave.status === 'pending' ? 'yellow' : 'red'}">${leave.status}</span></td>
                                            <td class="no-print">
                                                ${leave.status === 'pending' ? `
                                                    <button class="btn btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" onclick="updateLeaveStatus(${leave.id}, 'approved')">‚úì Approve</button>
                                                    <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" onclick="updateLeaveStatus(${leave.id}, 'rejected')">‚úó Reject</button>
                                                ` : ''}
                                                <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="deleteLeave(${leave.id})">Delete</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCalendar() {
            const { year, month, daysInMonth, startingDayOfWeek } = getCalendarData();
            const days = [];
            
            // Empty cells before month starts
            for (let i = 0; i < startingDayOfWeek; i++) {
                days.push('<div class="calendar-day" style="background: transparent; cursor: default;"></div>');
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const leavesOnDay = getLeaveForDate(date);
                const schedulesOnDay = state.scheduleData[dateStr] || [];
                const isToday = new Date().toDateString() === date.toDateString();
                const classes = ['calendar-day'];
                if (schedulesOnDay.length > 0) classes.push('has-schedule');
                if (leavesOnDay.length > 0) classes.push('has-leave');
                if (isToday) classes.push('today');
                
                days.push(`
                    <div class="${classes.join(' ')}" onclick="openScheduleDay('${dateStr}')">
                        ${day}
                        ${schedulesOnDay.length > 0 ? `<div class="schedule-indicator">${schedulesOnDay.length}</div>` : ''}
                        ${leavesOnDay.length > 0 ? `<div class="leave-count">${leavesOnDay.length}</div>` : ''}
                    </div>
                `);
            }
            
            return `
                <div>
                    <h2 class="section-title mb-20">üìÖ Schedule Calendar</h2>
                    
                    <div class="dashboard-card">
                        <div class="calendar-header">
                            <button class="btn btn-primary" onclick="previousMonth()">‚Üê Previous</button>
                            <h3 class="calendar-title">${state.calendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</h3>
                            <button class="btn btn-primary" onclick="nextMonth()">Next ‚Üí</button>
                        </div>
                        
                        <div class="calendar-grid">
                            ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => `<div class="calendar-day-name">${day}</div>`).join('')}
                            ${days.join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTimeTracking() {
            const stats = state.getStats();
            const dayOffCount = state.timeTrackingRecords.filter(t => t.type === 'dayoff').length;
            const typeIcons = { claims: 'üí∞', late: '‚è±Ô∏è', dayoff: 'üìÖ', overtime: '‚è∞' };
            const typeNames = { claims: 'Claims', late: 'Late', dayoff: 'Day Off', overtime: 'Overtime' };
            
            return `
                <div>
                    <div class="section-header">
                        <h2 class="section-title">‚è±Ô∏è Time Tracking</h2>
                        <div class="action-buttons">
                            <button class="btn btn-primary" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);" onclick="openModal('addClaim')">üí∞ Add Claim</button>
                            <button class="btn btn-primary" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);" onclick="openModal('addLate')">‚è±Ô∏è Log Late</button>
                            <button class="btn btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);" onclick="openModal('addDayOff')">üìÖ Day Off</button>
                            <button class="btn btn-primary" onclick="openModal('addOvertime')">‚è∞ Overtime</button>
                        </div>
                    </div>
                    
                    <div class="stats-grid mb-30">
                        <div class="kpi-card orange">
                            <h4 class="kpi-title">üí∞ Total Claims</h4>
                            <p style="font-size: 28px; font-weight: bold; color: #f59e0b;">${stats.claimsCount}</p>
                        </div>
                        <div class="kpi-card red">
                            <h4 class="kpi-title">‚è±Ô∏è Late Arrivals</h4>
                            <p style="font-size: 28px; font-weight: bold; color: #ef4444;">${stats.lateCount}</p>
                        </div>
                        <div class="kpi-card blue">
                            <h4 class="kpi-title">üìÖ Days Off</h4>
                            <p style="font-size: 28px; font-weight: bold; color: #3b82f6;">${dayOffCount}</p>
                        </div>
                        <div class="kpi-card green">
                            <h4 class="kpi-title">‚è∞ Overtime Hours</h4>
                            <p style="font-size: 28px; font-weight: bold; color: #10b981;">${stats.overtimeHours.toFixed(1)}h</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-card">
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Type</th>
                                        <th>Staff Name</th>
                                        <th>Department</th>
                                        <th>Date</th>
                                        <th>Details</th>
                                        <th>Notes</th>
                                        <th class="no-print">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${state.timeTrackingRecords.sort((a, b) => new Date(b.date) - new Date(a.date)).map(record => `
                                        <tr>
                                            <td><span style="font-size: 20px;">${typeIcons[record.type]}</span> ${typeNames[record.type]}</td>
                                            <td style="font-weight: 600;">${record.staffName}</td>
                                            <td>${record.staffDepartment}</td>
                                            <td>${formatDate(record.date)}</td>
                                            <td style="font-weight: bold;">
                                                ${record.type === 'claims' && record.amount ? `$${record.amount.toFixed(2)}` : ''}
                                                ${(record.type === 'late' || record.type === 'overtime') && record.hours ? `${record.hours} hrs` : ''}
                                                ${record.type === 'dayoff' ? '-' : ''}
                                            </td>
                                            <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;">${record.notes || '-'}</td>
                                            <td class="no-print">
                                                <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="deleteTimeTracking(${record.id})">Delete</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFleet() {
            return `
                <div>
                    <div class="section-header">
                        <h2 class="section-title">üöó Fleet Management</h2>
                        <button class="btn btn-primary" onclick="openModal('addVehicle')">‚ûï Add Vehicle</button>
                    </div>
                    
                    ${state.fleet.length === 0 ? `
                        <div class="dashboard-card text-center" style="padding: 60px;">
                            <p style="font-size: 48px; margin-bottom: 20px;">üöó</p>
                            <p style="font-size: 18px; color: #64748b; margin-bottom: 20px;">No vehicles added yet</p>
                            <button class="btn btn-primary" onclick="openModal('addVehicle')">Add Your First Vehicle</button>
                        </div>
                    ` : `
                        <div class="stats-grid">
                            ${state.fleet.map(vehicle => `
                                <div class="fleet-card">
                                    <div class="fleet-header">
                                        <div>
                                            <div class="fleet-id">${vehicle.vehicleId}</div>
                                            <span class="badge badge-${vehicle.status === 'active' ? 'green' : vehicle.status === 'maintenance' ? 'yellow' : 'red'}" style="margin-top: 8px;">
                                                ${vehicle.status}
                                            </span>
                                        </div>
                                        <div style="font-size: 32px;">
                                            ${vehicle.type === 'Ambulance' ? 'üöë' : vehicle.type === 'Van' ? 'üöê' : 'üöó'}
                                        </div>
                                    </div>
                                    
                                    <div class="fleet-info">
                                        <div class="fleet-label">Type</div>
                                        <div class="fleet-value">${vehicle.type}</div>
                                    </div>
                                    
                                    <div class="fleet-info">
                                        <div class="fleet-label">Driver</div>
                                        <div class="fleet-value">${vehicle.driver || 'Unassigned'}</div>
                                    </div>
                                    
                                    <div class="fleet-info">
                                        <div class="fleet-label">Trips</div>
                                        <div class="fleet-value">
                                            Inter: ${vehicle.interFacility || 0} | Intra: ${vehicle.intraFacility || 0}
                                        </div>
                                    </div>
                                    
                                    <div class="fleet-info">
                                        <div class="fleet-label">Last Maintenance</div>
                                        <div class="fleet-value">${vehicle.lastMaintenance ? formatDate(vehicle.lastMaintenance) : 'N/A'}</div>
                                    </div>
                                    
                                    ${vehicle.notes ? `
                                        <div class="fleet-info">
                                            <div class="fleet-label">Notes</div>
                                            <div class="fleet-value" style="font-size: 13px;">${vehicle.notes}</div>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="fleet-actions">
                                        <button class="btn btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="editVehicle(${vehicle.id})">Edit</button>
                                        <button class="btn btn-danger" style="padding: 8px 16px; font-size: 13px;" onclick="deleteVehicle(${vehicle.id})">Delete</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function renderUpdates() {
            return `
                <div>
                    <div class="section-header">
                        <h2 class="section-title">üì¢ Hospital Updates & Issues</h2>
                        <button class="btn btn-primary" onclick="openModal('addUpdate')">‚ûï Add Update</button>
                    </div>
                    
                    ${state.hospitalUpdates.length === 0 ? `
                        <div class="dashboard-card text-center" style="padding: 60px;">
                            <p style="font-size: 48px; margin-bottom: 20px;">üì¢</p>
                            <p style="font-size: 18px; color: #64748b; margin-bottom: 20px;">No updates posted yet</p>
                            <button class="btn btn-primary" onclick="openModal('addUpdate')">Post Your First Update</button>
                        </div>
                    ` : `
                        <div>
                            ${state.hospitalUpdates.sort((a, b) => new Date(b.date) - new Date(a.date)).map(update => `
                                <div class="update-card">
                                    <div class="update-header">
                                        <div class="update-title">${update.title}</div>
                                        <div class="update-date">${formatDateTime(update.date)}</div>
                                    </div>
                                    <div class="update-content">${update.content}</div>
                                    <div>
                                        <span class="update-type update-type-${update.type}">
                                            ${update.type === 'info' ? 'üìã Info' : update.type === 'warning' ? '‚ö†Ô∏è Warning' : 'üö® Issue'}
                                        </span>
                                        ${update.department ? `<span class="badge badge-blue" style="margin-left: 8px;">${update.department}</span>` : ''}
                                    </div>
                                    <div style="margin-top: 12px;">
                                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;" onclick="deleteUpdate(${update.id})">Delete</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function renderReports() {
            return `
                <div>
                    <h2 class="section-title mb-20">üìà Reports & Analytics</h2>
                    
                    <div class="dashboard-card mb-20">
                        <h3 class="font-bold mb-20">üìä Available Reports</h3>
                        <div class="stats-grid">
                            <div class="kpi-card blue" style="cursor: pointer;" onclick="printStaffReport()">
                                <h4 class="kpi-title">üë• Staff Report</h4>
                                <p style="color: #0ea5e9; margin-top: 8px;">Click to Print</p>
                            </div>
                            <div class="kpi-card green" style="cursor: pointer;" onclick="printLeaveReport()">
                                <h4 class="kpi-title">üèñÔ∏è Leave Report</h4>
                                <p style="color: #10b981; margin-top: 8px;">Click to Print</p>
                            </div>
                            <div class="kpi-card purple" style="cursor: pointer;" onclick="printTimeTrackingReport()">
                                <h4 class="kpi-title">‚è±Ô∏è Time Tracking Report</h4>
                                <p style="color: #a855f7; margin-top: 8px;">Click to Print</p>
                            </div>
                            <div class="kpi-card orange" style="cursor: pointer;" onclick="printFleetReport()">
                                <h4 class="kpi-title">üöó Fleet Report</h4>
                                <p style="color: #f97316; margin-top: 8px;">Click to Print</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderModal() {
            if (!state.modalOpen) return '';
            
            let content = '';
            switch(state.modalType) {
                case 'addLeave': content = renderLeaveForm(); break;
                case 'addClaim': content = renderTimeTrackingForm('claims'); break;
                case 'addLate': content = renderTimeTrackingForm('late'); break;
                case 'addDayOff': content = renderTimeTrackingForm('dayoff'); break;
                case 'addOvertime': content = renderTimeTrackingForm('overtime'); break;
                case 'addVehicle': content = renderVehicleForm(); break;
                case 'editVehicle': content = renderVehicleForm(state.editingItem); break;
                case 'addUpdate': content = renderUpdateForm(); break;
                case 'scheduleDay': content = renderScheduleForm(); break;
                default: content = '';
            }
            
            return `
                <div class="modal-overlay" onclick="closeModal()">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        ${content}
                    </div>
                </div>
            `;
        }

        function renderLeaveForm() {
            return `
                <form onsubmit="submitLeave(event)">
                    <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">üèñÔ∏è Request Leave</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Employee *</label>
                        <select class="form-select" id="leaveEmployeeId" required onchange="updateEmployeeInfo()">
                            <option value="">Select Employee</option>
                            ${state.staff.map(s => `<option value="${s.id}">${s.name} (${s.department})</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Leave Type *</label>
                        <select class="form-select" id="leaveType" required>
                            <option value="Vacation">Vacation</option>
                            <option value="Sick">Sick Leave</option>
                            <option value="Personal">Personal Leave</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Start Date *</label>
                            <input type="date" class="form-input" id="leaveStartDate" required onchange="calculateLeaveDays()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Date *</label>
                            <input type="date" class="form-input" id="leaveEndDate" required onchange="calculateLeaveDays()">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Total Days</label>
                        <input type="number" class="form-input" id="leaveDays" readonly style="background: #f1f5f9;">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Reason</label>
                        <textarea class="form-textarea" id="leaveReason" rows="3" placeholder="Optional reason for leave..."></textarea>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn" style="border: 2px solid #e2e8f0;" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Submit Request</button>
                    </div>
                </form>
            `;
        }

        function renderTimeTrackingForm(type) {
            const titles = { claims: 'üí∞ Add Claim', late: '‚è±Ô∏è Log Late Arrival', dayoff: 'üìÖ Log Day Off', overtime: '‚è∞ Log Overtime' };
            
            return `
                <form onsubmit="submitTimeTracking(event, '${type}')">
                    <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">${titles[type]}</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Staff Member *</label>
                        <select class="form-select" id="ttStaffId" required onchange="updateStaffInfo()">
                            <option value="">Select Staff</option>
                            ${state.staff.map(s => `<option value="${s.trn}">${s.name} (${s.department})</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date *</label>
                        <input type="date" class="form-input" id="ttDate" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    
                    ${type === 'claims' ? `
                        <div class="form-group">
                            <label class="form-label">Amount ($)</label>
                            <input type="number" step="0.01" class="form-input" id="ttAmount" placeholder="0.00">
                        </div>
                    ` : ''}
                    
                    ${(type === 'late' || type === 'overtime') ? `
                        <div class="form-group">
                            <label class="form-label">Hours</label>
                            <input type="number" step="0.5" class="form-input" id="ttHours" placeholder="0.0">
                        </div>
                    ` : ''}
                    
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea class="form-textarea" id="ttNotes" rows="3" placeholder="Optional notes..."></textarea>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn" style="border: 2px solid #e2e8f0;" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Add Record</button>
                    </div>
                </form>
            `;
        }

        function renderVehicleForm(vehicle = null) {
            const isEdit = vehicle !== null;
            return `
                <form onsubmit="submitVehicle(event, ${isEdit})">
                    <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">
                        ${isEdit ? '‚úèÔ∏è Edit Vehicle' : 'üöó Add Vehicle'}
                    </h2>
                    
                    <div class="form-group">
                        <label class="form-label">Vehicle ID *</label>
                        <input type="text" class="form-input" id="vehicleId" value="${vehicle?.vehicleId || ''}" required placeholder="e.g., AMB-001">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Type *</label>
                            <select class="form-select" id="vehicleType" required>
                                <option value="">Select Type</option>
                                <option value="Ambulance" ${vehicle?.type === 'Ambulance' ? 'selected' : ''}>Ambulance</option>
                                <option value="Van" ${vehicle?.type === 'Van' ? 'selected' : ''}>Van</option>
                                <option value="Car" ${vehicle?.type === 'Car' ? 'selected' : ''}>Car</option>
                                <option value="Other" ${vehicle?.type === 'Other' ? 'selected' : ''}>Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status *</label>
                            <select class="form-select" id="vehicleStatus" required>
                                <option value="active" ${vehicle?.status === 'active' ? 'selected' : ''}>Active</option>
                                <option value="maintenance" ${vehicle?.status === 'maintenance' ? 'selected' : ''}>Maintenance</option>
                                <option value="inactive" ${vehicle?.status === 'inactive' ? 'selected' : ''}>Inactive</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Driver</label>
                        <input type="text" class="form-input" id="vehicleDriver" value="${vehicle?.driver || ''}" placeholder="Driver name">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Inter-facility Trips</label>
                            <input type="number" class="form-input" id="vehicleInter" value="${vehicle?.interFacility || 0}" min="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Intra-facility Trips</label>
                            <input type="number" class="form-input" id="vehicleIntra" value="${vehicle?.intraFacility || 0}" min="0">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Last Maintenance</label>
                        <input type="date" class="form-input" id="vehicleMaintenance" value="${vehicle?.lastMaintenance || ''}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Notes</label>
                        <textarea class="form-textarea" id="vehicleNotes" rows="3" placeholder="Additional notes...">${vehicle?.notes || ''}</textarea>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn" style="border: 2px solid #e2e8f0;" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">${isEdit ? 'Update Vehicle' : 'Add Vehicle'}</button>
                    </div>
                </form>
            `;
        }

        function renderUpdateForm() {
            return `
                <form onsubmit="submitUpdate(event)">
                    <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">üì¢ Post Update</h2>
                    
                    <div class="form-group">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-input" id="updateTitle" required placeholder="Update title">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Type *</label>
                        <select class="form-select" id="updateType" required>
                            <option value="info">üìã Information</option>
                            <option value="warning">‚ö†Ô∏è Warning</option>
                            <option value="issue">üö® Issue</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Department</label>
                        <select class="form-select" id="updateDepartment">
                            <option value="">All Departments</option>
                            ${state.departments.map(d => `<option value="${d.name}">${d.name}</option>`).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Content *</label>
                        <textarea class="form-textarea" id="updateContent" rows="5" required placeholder="Update details..."></textarea>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="button" class="btn" style="border: 2px solid #e2e8f0;" onclick="closeModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Post Update</button>
                    </div>
                </form>
            `;
        }

        function renderScheduleForm() {
            const dateStr = state.selectedDate;
            const schedules = state.scheduleData[dateStr] || [];
            
            return `
                <div style="max-width: 800px;">
                    <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 20px;">
                        üìÖ Schedule for ${formatDate(dateStr)}
                    </h2>
                    
                    <form onsubmit="submitSchedule(event)" style="margin-bottom: 30px; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 16px;">Add Schedule</h3>
                        
                        <div class="form-group">
                            <label class="form-label">Staff Member *</label>
                            <select class="form-select" id="scheduleStaffId" required>
                                <option value="">Select Staff</option>
                                ${state.staff.map(s => `<option value="${s.trn}">${s.name} - ${s.department}</option>`).join('')}
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Start Time *</label>
                                <input type="time" class="form-input" id="scheduleStartTime" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time *</label>
                                <input type="time" class="form-input" id="scheduleEndTime" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Assignment</label>
                            <input type="text" class="form-input" id="scheduleAssignment" placeholder="e.g., Emergency Ward, Transport Duty">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-textarea" id="scheduleNotes" rows="2" placeholder="Additional notes..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%;">Add to Schedule</button>
                    </form>
                    
                    <div>
                        <h3 style="font-size: 18px; font-weight: bold; margin-bottom: 16px;">Current Schedule (${schedules.length})</h3>
                        ${schedules.length === 0 ? '<p style="color: #64748b;">No schedules for this day</p>' : `
                            <div class="schedule-list">
                                ${schedules.map((schedule, index) => `
                                    <div class="schedule-item">
                                        <div class="schedule-staff-name">${schedule.staffName}</div>
                                        <div class="schedule-details">
                                            <span>‚è∞ ${schedule.startTime} - ${schedule.endTime}</span>
                                            ${schedule.assignment ? `<span>üìã ${schedule.assignment}</span>` : ''}
                                            ${schedule.notes ? `<span>üìù ${schedule.notes}</span>` : ''}
                                        </div>
                                        <button class="btn btn-danger" style="padding: 6px 12px; font-size: 12px; margin-top: 8px;" onclick="deleteSchedule('${dateStr}', ${index})">Delete</button>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                    
                    <div class="modal-actions" style="margin-top: 20px;">
                        <button type="button" class="btn" style="border: 2px solid #e2e8f0;" onclick="closeModal()">Close</button>
                    </div>
                </div>
            `;
        }

        function renderFloatingButton() {
            return '<button class="floating-btn no-print" onclick="exportToExcel()">üìä Export</button>';
        }

        // ============ EVENT HANDLERS ============
        function switchTab(tab) {
            state.activeTab = tab;
            render();
        }

        function toggleDarkMode() {
            state.toggleDarkMode();
            render();
        }

        function openModal(type) {
            state.modalOpen = true;
            state.modalType = type;
            render();
        }

        function closeModal() {
            state.modalOpen = false;
            state.modalType = '';
            state.editingItem = null;
            render();
        }

        function openScheduleDay(dateStr) {
            state.selectedDate = dateStr;
            state.modalOpen = true;
            state.modalType = 'scheduleDay';
            render();
        }

        function submitLeave(e) {
            e.preventDefault();
            
            const employeeId = document.getElementById('leaveEmployeeId').value;
            const employee = state.staff.find(s => s.id.toString() === employeeId);
            
            if (!employee) {
                showAlert('‚ö†Ô∏è Please select an employee');
                return;
            }
            
            const leaveRecord = {
                id: Date.now(),
                employeeId: employee.id,
                employeeName: employee.name,
                department: employee.department,
                type: document.getElementById('leaveType').value,
                startDate: document.getElementById('leaveStartDate').value,
                endDate: document.getElementById('leaveEndDate').value,
                days: parseInt(document.getElementById('leaveDays').value) || 0,
                reason: document.getElementById('leaveReason').value,
                status: 'pending',
                timestamp: new Date().toISOString()
            };
            
            state.leaveRecords.push(leaveRecord);
            state.save();
            closeModal();
            showAlert('‚úÖ Leave request submitted successfully');
        }

        function submitTimeTracking(e, type) {
            e.preventDefault();
            
            const staffId = document.getElementById('ttStaffId').value;
            const staffMember = state.staff.find(s => s.trn === staffId);
            
            if (!staffMember) {
                showAlert('‚ö†Ô∏è Please select a staff member');
                return;
            }
            
            const record = {
                id: Date.now(),
                type: type,
                staffId: staffId,
                staffName: staffMember.name,
                staffDepartment: staffMember.department,
                date: document.getElementById('ttDate').value,
                notes: document.getElementById('ttNotes').value,
                timestamp: new Date().toISOString()
            };
            
            if (type === 'claims') {
                record.amount = parseFloat(document.getElementById('ttAmount').value) || 0;
            } else if (type === 'late' || type === 'overtime') {
                record.hours = parseFloat(document.getElementById('ttHours').value) || 0;
            }
            
            state.timeTrackingRecords.push(record);
            state.save();
            closeModal();
            showAlert(`‚úÖ ${type} record added successfully`);
        }

        function submitVehicle(e, isEdit) {
            e.preventDefault();
            
            const vehicle = {
                vehicleId: document.getElementById('vehicleId').value,
                type: document.getElementById('vehicleType').value,
                status: document.getElementById('vehicleStatus').value,
                driver: document.getElementById('vehicleDriver').value,
                interFacility: parseInt(document.getElementById('vehicleInter').value) || 0,
                intraFacility: parseInt(document.getElementById('vehicleIntra').value) || 0,
                lastMaintenance: document.getElementById('vehicleMaintenance').value,
                notes: document.getElementById('vehicleNotes').value,
            };
            
            vehicle.totalTrips = vehicle.interFacility + vehicle.intraFacility;
            
            if (isEdit && state.editingItem) {
                const index = state.fleet.findIndex(v => v.id === state.editingItem.id);
                state.fleet[index] = { ...vehicle, id: state.editingItem.id };
                showAlert('‚úÖ Vehicle updated successfully');
            } else {
                vehicle.id = Date.now();
                state.fleet.push(vehicle);
                showAlert('‚úÖ Vehicle added successfully');
            }
            
            state.save();
            closeModal();
        }

        function submitUpdate(e) {
            e.preventDefault();
            
            const update = {
                id: Date.now(),
                title: document.getElementById('updateTitle').value,
                type: document.getElementById('updateType').value,
                department: document.getElementById('updateDepartment').value,
                content: document.getElementById('updateContent').value,
                date: new Date().toISOString()
            };
            
            state.hospitalUpdates.push(update);
            state.save();
            closeModal();
            showAlert('‚úÖ Update posted successfully');
        }

        function submitSchedule(e) {
            e.preventDefault();
            
            const staffId = document.getElementById('scheduleStaffId').value;
            const staffMember = state.staff.find(s => s.trn === staffId);
            
            if (!staffMember) {
                showAlert('‚ö†Ô∏è Please select a staff member');
                return;
            }
            
            const schedule = {
                staffId: staffId,
                staffName: staffMember.name,
                staffDepartment: staffMember.department,
                startTime: document.getElementById('scheduleStartTime').value,
                endTime: document.getElementById('scheduleEndTime').value,
                assignment: document.getElementById('scheduleAssignment').value,
                notes: document.getElementById('scheduleNotes').value,
            };
            
            const dateStr = state.selectedDate;
            if (!state.scheduleData[dateStr]) {
                state.scheduleData[dateStr] = [];
            }
            
            state.scheduleData[dateStr].push(schedule);
            state.save();
            showAlert('‚úÖ Schedule added successfully');
            
            // Re-render modal to show updated schedule
            state.modalOpen = true;
            state.modalType = 'scheduleDay';
            render();
        }

        function deleteSchedule(dateStr, index) {
            if (confirm('Delete this schedule?')) {
                state.scheduleData[dateStr].splice(index, 1);
                if (state.scheduleData[dateStr].length === 0) {
                    delete state.scheduleData[dateStr];
                }
                state.save();
                showAlert('‚úÖ Schedule deleted');
                
                // Re-render modal
                state.modalOpen = true;
                state.modalType = 'scheduleDay';
                render();
            }
        }

        function editVehicle(id) {
            const vehicle = state.fleet.find(v => v.id === id);
            state.editingItem = vehicle;
            state.modalOpen = true;
            state.modalType = 'editVehicle';
            render();
        }

        function deleteVehicle(id) {
            if (confirm('Delete this vehicle?')) {
                state.fleet = state.fleet.filter(v => v.id !== id);
                state.save();
                render();
                showAlert('‚úÖ Vehicle deleted');
            }
        }

        function deleteUpdate(id) {
            if (confirm('Delete this update?')) {
                state.hospitalUpdates = state.hospitalUpdates.filter(u => u.id !== id);
                state.save();
                render();
                showAlert('‚úÖ Update deleted');
            }
        }

        function updateLeaveStatus(id, status) {
            const leave = state.leaveRecords.find(l => l.id === id);
            if (leave) {
                leave.status = status;
                state.save();
                render();
                showAlert(`‚úÖ Leave ${status}`);
            }
        }

        function deleteLeave(id) {
            if (confirm('Delete this leave record?')) {
                state.leaveRecords = state.leaveRecords.filter(l => l.id !== id);
                state.save();
                render();
                showAlert('‚úÖ Leave record deleted');
            }
        }

        function deleteStaff(id) {
            if (confirm('Delete this staff member?')) {
                state.staff = state.staff.filter(s => s.id !== id);
                state.save();
                render();
                showAlert('‚úÖ Staff member deleted');
            }
        }

        function deleteTimeTracking(id) {
            if (confirm('Delete this time tracking record?')) {
                state.timeTrackingRecords = state.timeTrackingRecords.filter(t => t.id !== id);
                state.save();
                render();
                showAlert('‚úÖ Record deleted');
            }
        }

        function calculateLeaveDays() {
            const start = document.getElementById('leaveStartDate').value;
            const end = document.getElementById('leaveEndDate').value;
            
            if (start && end) {
                const startDate = new Date(start);
                const endDate = new Date(end);
                const diffTime = Math.abs(endDate - startDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                document.getElementById('leaveDays').value = diffDays;
            }
        }

        function updateEmployeeInfo() {
            // Placeholder for additional employee info updates
        }

        function updateStaffInfo() {
            // Placeholder for additional staff info updates
        }

        // ============ CALENDAR FUNCTIONS ============
        function getCalendarData() {
            const year = state.calendarDate.getFullYear();
            const month = state.calendarDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            return { year, month, daysInMonth, startingDayOfWeek };
        }

        function getLeaveForDate(date) {
            const dateStr = new Date(date).toISOString().split('T')[0];
            return state.leaveRecords.filter(leave => {
                const start = new Date(leave.startDate);
                const end = new Date(leave.endDate);
                const current = new Date(dateStr);
                return current >= start && current <= end && leave.status === 'approved';
            });
        }

        function previousMonth() {
            state.calendarDate = new Date(state.calendarDate.getFullYear(), state.calendarDate.getMonth() - 1, 1);
            render();
        }

        function nextMonth() {
            state.calendarDate = new Date(state.calendarDate.getFullYear(), state.calendarDate.getMonth() + 1, 1);
            render();
        }

        // ============ EXPORT/IMPORT FUNCTIONS ============
        function exportToExcel() {
            const wb = XLSX.utils.book_new();
            
            // Staff sheet
            const staffWS = XLSX.utils.json_to_sheet(state.staff);
            XLSX.utils.book_append_sheet(wb, staffWS, 'Staff');
            
            // Departments sheet
            const deptWS = XLSX.utils.json_to_sheet(state.departments);
            XLSX.utils.book_append_sheet(wb, deptWS, 'Departments');
            
            // Fleet sheet
            if (state.fleet.length > 0) {
                const fleetWS = XLSX.utils.json_to_sheet(state.fleet);
                XLSX.utils.book_append_sheet(wb, fleetWS, 'Fleet');
            }
            
            // Leave records sheet
            if (state.leaveRecords.length > 0) {
                const leaveWS = XLSX.utils.json_to_sheet(state.leaveRecords);
                XLSX.utils.book_append_sheet(wb, leaveWS, 'Leave Records');
            }
            
            // Time tracking sheet
            if (state.timeTrackingRecords.length > 0) {
                const timeWS = XLSX.utils.json_to_sheet(state.timeTrackingRecords);
                XLSX.utils.book_append_sheet(wb, timeWS, 'Time Tracking');
            }
            
            // Hospital updates sheet
            if (state.hospitalUpdates.length > 0) {
                const updatesWS = XLSX.utils.json_to_sheet(state.hospitalUpdates);
                XLSX.utils.book_append_sheet(wb, updatesWS, 'Updates');
            }
            
            XLSX.writeFile(wb, `Hospital_Management_Report_${new Date().toISOString().split('T')[0]}.xlsx`);
            showAlert('‚úÖ Excel file exported successfully');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (file.name.endsWith('.json')) {
                        const data = JSON.parse(e.target.result);
                        if (data.staff) state.staff = data.staff;
                        if (data.departments) state.departments = data.departments;
                        if (data.fleet) state.fleet = data.fleet;
                        if (data.leaveRecords) state.leaveRecords = data.leaveRecords;
                        if (data.timeTrackingRecords) state.timeTrackingRecords = data.timeTrackingRecords;
                        if (data.hospitalUpdates) state.hospitalUpdates = data.hospitalUpdates;
                        if (data.scheduleData) state.scheduleData = data.scheduleData;
                    } else {
                        const wb = XLSX.read(e.target.result, { type: 'binary' });
                        
                        if (wb.SheetNames.includes('Staff')) {
                            state.staff = XLSX.utils.sheet_to_json(wb.Sheets['Staff']);
                        }
                        if (wb.SheetNames.includes('Fleet')) {
                            state.fleet = XLSX.utils.sheet_to_json(wb.Sheets['Fleet']);
                        }
                        if (wb.SheetNames.includes('Leave Records')) {
                            state.leaveRecords = XLSX.utils.sheet_to_json(wb.Sheets['Leave Records']);
                        }
                        if (wb.SheetNames.includes('Time Tracking')) {
                            state.timeTrackingRecords = XLSX.utils.sheet_to_json(wb.Sheets['Time Tracking']);
                        }
                        if (wb.SheetNames.includes('Updates')) {
                            state.hospitalUpdates = XLSX.utils.sheet_to_json(wb.Sheets['Updates']);
                        }
                    }
                    
                    state.save();
                    render();
                    showAlert('‚úÖ Data imported successfully');
                } catch (error) {
                    console.error('Import error:', error);
                    showAlert('‚ùå Failed to import data');
                }
            };
            
            if (file.name.endsWith('.json')) {
                reader.readAsText(file);
            } else {
                reader.readAsBinaryString(file);
            }
            
            // Reset file input
            event.target.value = '';
        }

        // ============ SYNC FUNCTIONS ============
        async function syncData() {
            if (!CONFIG.USE_GOOGLE_SHEETS || !CONFIG.SCRIPT_URL) {
                showAlert('‚ö†Ô∏è Google Sheets sync is not configured');
                return;
            }
            
            try {
                showAlert('üîÑ Syncing with Google Sheets...');
                // Add your Google Sheets sync logic here
                showAlert('‚úÖ Sync completed successfully');
            } catch (error) {
                console.error('Sync error:', error);
                showAlert('‚ùå Sync failed');
            }
        }

        // ============ PRINT FUNCTIONS ============
        function printStaffReport() {
            document.getElementById('printArea').innerHTML = `
                <div class="print-header">
                    <h1>üë• Staff Report</h1>
                    <p>Generated on ${new Date().toLocaleDateString()}</p>
                </div>
                <div class="print-summary">
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.staff.length}</div>
                        <div class="print-summary-label">Total Staff</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.staff.filter(s => s.status === 'active').length}</div>
                        <div class="print-summary-label">Active Staff</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${[...new Set(state.staff.map(s => s.department))].length}</div>
                        <div class="print-summary-label">Departments</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.staff.filter(s => s.status !== 'active').length}</div>
                        <div class="print-summary-label">Inactive</div>
                    </div>
                </div>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>TRN</th>
                            <th>Name</th>
                            <th>Department</th>
                            <th>Position</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${state.staff.map(s => `
                            <tr>
                                <td>${s.trn}</td>
                                <td>${s.name}</td>
                                <td>${s.department}</td>
                                <td>${s.position}</td>
                                <td>${s.status}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            window.print();
        }

        function printLeaveReport() {
            document.getElementById('printArea').innerHTML = `
                <div class="print-header">
                    <h1>üèñÔ∏è Leave Report</h1>
                    <p>Generated on ${new Date().toLocaleDateString()}</p>
                </div>
                <div class="print-summary">
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.leaveRecords.length}</div>
                        <div class="print-summary-label">Total Requests</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.leaveRecords.filter(l => l.status === 'pending').length}</div>
                        <div class="print-summary-label">Pending</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.leaveRecords.filter(l => l.status === 'approved').length}</div>
                        <div class="print-summary-label">Approved</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.leaveRecords.filter(l => l.status === 'rejected').length}</div>
                        <div class="print-summary-label">Rejected</div>
                    </div>
                </div>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Type</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Days</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${state.leaveRecords.map(l => `
                            <tr>
                                <td>${l.employeeName}</td>
                                <td>${l.type}</td>
                                <td>${formatDate(l.startDate)}</td>
                                <td>${formatDate(l.endDate)}</td>
                                <td>${l.days}</td>
                                <td>${l.status}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            window.print();
        }

        function printTimeTrackingReport() {
            const stats = state.getStats();
            const dayOffCount = state.timeTrackingRecords.filter(t => t.type === 'dayoff').length;
            
            document.getElementById('printArea').innerHTML = `
                <div class="print-header">
                    <h1>‚è±Ô∏è Time Tracking Report</h1>
                    <p>Generated on ${new Date().toLocaleDateString()}</p>
                </div>
                <div class="print-summary">
                    <div class="print-summary-item">
                        <div class="print-summary-value">${stats.claimsCount}</div>
                        <div class="print-summary-label">Claims</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${stats.lateCount}</div>
                        <div class="print-summary-label">Late Arrivals</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${dayOffCount}</div>
                        <div class="print-summary-label">Days Off</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${stats.overtimeHours.toFixed(1)}h</div>
                        <div class="print-summary-label">Overtime Hours</div>
                    </div>
                </div>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Staff Name</th>
                            <th>Date</th>
                            <th>Details</th>
                            <th>Notes</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${state.timeTrackingRecords.map(t => {
                            const typeIcons = { claims: 'üí∞', late: '‚è±Ô∏è', dayoff: 'üìÖ', overtime: '‚è∞' };
                            const typeNames = { claims: 'Claims', late: 'Late', dayoff: 'Day Off', overtime: 'Overtime' };
                            return `
                                <tr>
                                    <td>${typeIcons[t.type]} ${typeNames[t.type]}</td>
                                    <td>${t.staffName}</td>
                                    <td>${formatDate(t.date)}</td>
                                    <td>
                                        ${t.type === 'claims' && t.amount ? `$${t.amount.toFixed(2)}` : ''}
                                        ${(t.type === 'late' || t.type === 'overtime') && t.hours ? `${t.hours} hrs` : ''}
                                        ${t.type === 'dayoff' ? '-' : ''}
                                    </td>
                                    <td>${t.notes || '-'}</td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;
            window.print();
        }

        function printFleetReport() {
            const stats = state.getStats();
            
            document.getElementById('printArea').innerHTML = `
                <div class="print-header">
                    <h1>üöó Fleet Report</h1>
                    <p>Generated on ${new Date().toLocaleDateString()}</p>
                </div>
                <div class="print-summary">
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.fleet.length}</div>
                        <div class="print-summary-label">Total Vehicles</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.fleet.filter(v => v.status === 'active').length}</div>
                        <div class="print-summary-label">Active</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${state.fleet.filter(v => v.status === 'maintenance').length}</div>
                        <div class="print-summary-label">Maintenance</div>
                    </div>
                    <div class="print-summary-item">
                        <div class="print-summary-value">${stats.totalTrips}</div>
                        <div class="print-summary-label">Total Trips</div>
                    </div>
                </div>
                <table class="print-table">
                    <thead>
                        <tr>
                            <th>Vehicle ID</th>
                            <th>Type</th>
                            <th>Driver</th>
                            <th>Inter-facility</th>
                            <th>Intra-facility</th>
                            <th>Total Trips</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${state.fleet.map(v => `
                            <tr>
                                <td>${v.vehicleId}</td>
                                <td>${v.type}</td>
                                <td>${v.driver || 'Unassigned'}</td>
                                <td>${v.interFacility || 0}</td>
                                <td>${v.intraFacility || 0}</td>
                                <td>${v.totalTrips || 0}</td>
                                <td>${v.status}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            window.print();
        }

        // ============ INITIALIZE ============
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                render();
            }, 500);
        });
    </script>
</body>
</html>
